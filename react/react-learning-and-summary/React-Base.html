<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Learing And Sharing</title>
    <meta name="description" content="好好学习，天天向上💪">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/keep-Learning/assets/css/0.styles.69d11f16.css" as="style"><link rel="preload" href="/keep-Learning/assets/js/app.90ccec97.js" as="script"><link rel="preload" href="/keep-Learning/assets/js/2.71580b53.js" as="script"><link rel="preload" href="/keep-Learning/assets/js/80.a48aa37a.js" as="script"><link rel="prefetch" href="/keep-Learning/assets/js/10.99f30dcf.js"><link rel="prefetch" href="/keep-Learning/assets/js/100.53100d9a.js"><link rel="prefetch" href="/keep-Learning/assets/js/101.02f72051.js"><link rel="prefetch" href="/keep-Learning/assets/js/102.60bb996e.js"><link rel="prefetch" href="/keep-Learning/assets/js/103.c7f3df5b.js"><link rel="prefetch" href="/keep-Learning/assets/js/104.e8378220.js"><link rel="prefetch" href="/keep-Learning/assets/js/105.90235e89.js"><link rel="prefetch" href="/keep-Learning/assets/js/106.f4905ea3.js"><link rel="prefetch" href="/keep-Learning/assets/js/107.02dfbd1b.js"><link rel="prefetch" href="/keep-Learning/assets/js/108.e4ffed8c.js"><link rel="prefetch" href="/keep-Learning/assets/js/109.2f6191db.js"><link rel="prefetch" href="/keep-Learning/assets/js/11.ccfc084d.js"><link rel="prefetch" href="/keep-Learning/assets/js/110.05776fb6.js"><link rel="prefetch" href="/keep-Learning/assets/js/111.b05f070d.js"><link rel="prefetch" href="/keep-Learning/assets/js/112.e07a4e74.js"><link rel="prefetch" href="/keep-Learning/assets/js/113.71af1d2b.js"><link rel="prefetch" href="/keep-Learning/assets/js/114.914195f4.js"><link rel="prefetch" href="/keep-Learning/assets/js/115.3a0e92aa.js"><link rel="prefetch" href="/keep-Learning/assets/js/116.4ab80baa.js"><link rel="prefetch" href="/keep-Learning/assets/js/12.5bee8056.js"><link rel="prefetch" href="/keep-Learning/assets/js/13.05de0df0.js"><link rel="prefetch" href="/keep-Learning/assets/js/14.d86b4a20.js"><link rel="prefetch" href="/keep-Learning/assets/js/15.887efa99.js"><link rel="prefetch" href="/keep-Learning/assets/js/16.f7c7fa8d.js"><link rel="prefetch" href="/keep-Learning/assets/js/17.dbf7a65f.js"><link rel="prefetch" href="/keep-Learning/assets/js/18.e57690bf.js"><link rel="prefetch" href="/keep-Learning/assets/js/19.7486ada7.js"><link rel="prefetch" href="/keep-Learning/assets/js/20.d9250e4c.js"><link rel="prefetch" href="/keep-Learning/assets/js/21.71046546.js"><link rel="prefetch" href="/keep-Learning/assets/js/22.5d1bafeb.js"><link rel="prefetch" href="/keep-Learning/assets/js/23.06f0e746.js"><link rel="prefetch" href="/keep-Learning/assets/js/24.2d27300f.js"><link rel="prefetch" href="/keep-Learning/assets/js/25.08ee3872.js"><link rel="prefetch" href="/keep-Learning/assets/js/26.b747bff1.js"><link rel="prefetch" href="/keep-Learning/assets/js/27.895e5c28.js"><link rel="prefetch" href="/keep-Learning/assets/js/28.8674bd28.js"><link rel="prefetch" href="/keep-Learning/assets/js/29.00b3c0e2.js"><link rel="prefetch" href="/keep-Learning/assets/js/3.227fd7b0.js"><link rel="prefetch" href="/keep-Learning/assets/js/30.7c8a2e90.js"><link rel="prefetch" href="/keep-Learning/assets/js/31.4e94fa86.js"><link rel="prefetch" href="/keep-Learning/assets/js/32.24db43de.js"><link rel="prefetch" href="/keep-Learning/assets/js/33.3a9d7c5b.js"><link rel="prefetch" href="/keep-Learning/assets/js/34.455ff1fa.js"><link rel="prefetch" href="/keep-Learning/assets/js/35.bf04ef16.js"><link rel="prefetch" href="/keep-Learning/assets/js/36.f733bfb6.js"><link rel="prefetch" href="/keep-Learning/assets/js/37.507ec8ee.js"><link rel="prefetch" href="/keep-Learning/assets/js/38.4c8024fc.js"><link rel="prefetch" href="/keep-Learning/assets/js/39.e5094649.js"><link rel="prefetch" href="/keep-Learning/assets/js/4.c62e84b3.js"><link rel="prefetch" href="/keep-Learning/assets/js/40.6dd7a473.js"><link rel="prefetch" href="/keep-Learning/assets/js/41.14db9a5d.js"><link rel="prefetch" href="/keep-Learning/assets/js/42.342c49d2.js"><link rel="prefetch" href="/keep-Learning/assets/js/43.e2f02df0.js"><link rel="prefetch" href="/keep-Learning/assets/js/44.85c43572.js"><link rel="prefetch" href="/keep-Learning/assets/js/45.2d71b584.js"><link rel="prefetch" href="/keep-Learning/assets/js/46.26841be2.js"><link rel="prefetch" href="/keep-Learning/assets/js/47.2be49ff6.js"><link rel="prefetch" href="/keep-Learning/assets/js/48.b0982983.js"><link rel="prefetch" href="/keep-Learning/assets/js/49.0160ec63.js"><link rel="prefetch" href="/keep-Learning/assets/js/5.c9cb8de9.js"><link rel="prefetch" href="/keep-Learning/assets/js/50.d1a3af12.js"><link rel="prefetch" href="/keep-Learning/assets/js/51.a655886f.js"><link rel="prefetch" href="/keep-Learning/assets/js/52.93851e74.js"><link rel="prefetch" href="/keep-Learning/assets/js/53.c8009c28.js"><link rel="prefetch" href="/keep-Learning/assets/js/54.7945804f.js"><link rel="prefetch" href="/keep-Learning/assets/js/55.0d1b82a0.js"><link rel="prefetch" href="/keep-Learning/assets/js/56.ea4f3968.js"><link rel="prefetch" href="/keep-Learning/assets/js/57.c7fe55e7.js"><link rel="prefetch" href="/keep-Learning/assets/js/58.e2e1b6dd.js"><link rel="prefetch" href="/keep-Learning/assets/js/59.195b09a3.js"><link rel="prefetch" href="/keep-Learning/assets/js/6.7294f365.js"><link rel="prefetch" href="/keep-Learning/assets/js/60.b0c6ca2b.js"><link rel="prefetch" href="/keep-Learning/assets/js/61.d8137606.js"><link rel="prefetch" href="/keep-Learning/assets/js/62.354a6c3b.js"><link rel="prefetch" href="/keep-Learning/assets/js/63.42a16259.js"><link rel="prefetch" href="/keep-Learning/assets/js/64.44130cd9.js"><link rel="prefetch" href="/keep-Learning/assets/js/65.826334d1.js"><link rel="prefetch" href="/keep-Learning/assets/js/66.39bd2327.js"><link rel="prefetch" href="/keep-Learning/assets/js/67.89147bbe.js"><link rel="prefetch" href="/keep-Learning/assets/js/68.a7602bd4.js"><link rel="prefetch" href="/keep-Learning/assets/js/69.028f1340.js"><link rel="prefetch" href="/keep-Learning/assets/js/7.a9fa44ec.js"><link rel="prefetch" href="/keep-Learning/assets/js/70.3bb91667.js"><link rel="prefetch" href="/keep-Learning/assets/js/71.65fb15dd.js"><link rel="prefetch" href="/keep-Learning/assets/js/72.00066c85.js"><link rel="prefetch" href="/keep-Learning/assets/js/73.47b522ff.js"><link rel="prefetch" href="/keep-Learning/assets/js/74.7a6ef089.js"><link rel="prefetch" href="/keep-Learning/assets/js/75.b187d3a1.js"><link rel="prefetch" href="/keep-Learning/assets/js/76.88a347ac.js"><link rel="prefetch" href="/keep-Learning/assets/js/77.6f86a34a.js"><link rel="prefetch" href="/keep-Learning/assets/js/78.d0ed26d6.js"><link rel="prefetch" href="/keep-Learning/assets/js/79.83c1ce53.js"><link rel="prefetch" href="/keep-Learning/assets/js/8.acbc06dd.js"><link rel="prefetch" href="/keep-Learning/assets/js/81.6eacd104.js"><link rel="prefetch" href="/keep-Learning/assets/js/82.25ef373b.js"><link rel="prefetch" href="/keep-Learning/assets/js/83.09550954.js"><link rel="prefetch" href="/keep-Learning/assets/js/84.e8671abc.js"><link rel="prefetch" href="/keep-Learning/assets/js/85.b1b7d209.js"><link rel="prefetch" href="/keep-Learning/assets/js/86.d297bac9.js"><link rel="prefetch" href="/keep-Learning/assets/js/87.eeea66b3.js"><link rel="prefetch" href="/keep-Learning/assets/js/88.0ea72a36.js"><link rel="prefetch" href="/keep-Learning/assets/js/89.4155e98e.js"><link rel="prefetch" href="/keep-Learning/assets/js/9.ad2f8d07.js"><link rel="prefetch" href="/keep-Learning/assets/js/90.611a7011.js"><link rel="prefetch" href="/keep-Learning/assets/js/91.e84d85cf.js"><link rel="prefetch" href="/keep-Learning/assets/js/92.30b75a79.js"><link rel="prefetch" href="/keep-Learning/assets/js/93.0ccb8db1.js"><link rel="prefetch" href="/keep-Learning/assets/js/94.f5e0fbaf.js"><link rel="prefetch" href="/keep-Learning/assets/js/95.7e23aad8.js"><link rel="prefetch" href="/keep-Learning/assets/js/96.654c8e0c.js"><link rel="prefetch" href="/keep-Learning/assets/js/97.b65e23fb.js"><link rel="prefetch" href="/keep-Learning/assets/js/98.e14a8d6c.js"><link rel="prefetch" href="/keep-Learning/assets/js/99.e2ce5525.js">
    <link rel="stylesheet" href="/keep-Learning/assets/css/0.styles.69d11f16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/keep-Learning/" class="home-link router-link-active"><!----> <span class="site-name">Learing And Sharing</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/keep-Learning/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分享" class="dropdown-title"><span class="title">技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/keep-Learning/javascript/javascript-learning-and-summary/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/html/html-learning-and-summary/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/css/css-learning-and-summary/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/react/" class="nav-link router-link-active">
  React
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/webpack/webpack-learning-and-summary/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/ts/ts-learning-and-summary/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/nodejs/nodejs-learning-and-summary/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/weex/weex-learning-and-summary/" class="nav-link">
  Weex
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/network/network-learning-and-summary/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/datastructure/datastructure-learning-and-summary/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/mixin/mixin-learning-and-summary/" class="nav-link">
  日常杂记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Andraw-lin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/keep-Learning/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分享" class="dropdown-title"><span class="title">技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/keep-Learning/javascript/javascript-learning-and-summary/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/html/html-learning-and-summary/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/css/css-learning-and-summary/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/react/" class="nav-link router-link-active">
  React
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/webpack/webpack-learning-and-summary/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/ts/ts-learning-and-summary/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/nodejs/nodejs-learning-and-summary/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/weex/weex-learning-and-summary/" class="nav-link">
  Weex
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/network/network-learning-and-summary/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/datastructure/datastructure-learning-and-summary/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/mixin/mixin-learning-and-summary/" class="nav-link">
  日常杂记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Andraw-lin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/keep-Learning/react/react-learning-and-summary" class="sidebar-heading clickable router-link-active open"><span>React 学习和总结</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/keep-Learning/react/react-learning-and-summary/About-React-Render-And-Update.html" class="sidebar-link">个人见解之 React 渲染与更新</a></li><li><a href="/keep-Learning/react/react-learning-and-summary/React-Summary.html" class="sidebar-link">React 知识点总结</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><hr> <blockquote><p>React Concept</p></blockquote> <p><strong>一、Create A React Component</strong></p> <p>目前以创建一个简单的点击计数器组件为例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ClickCounter.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">ClickCounter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token comment">// 绑定事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onClickButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClickButton</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token comment">// 设置状态属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onClickButton <span class="token punctuation">}</span><span class="token operator">&gt;</span>Click Me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        Click Count<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> ClickCounter
</code></pre></div><p><strong>React 中的组件命名和文件命名都是统一使用驼峰原则</strong>。对于事件的定义，都需要统一进行绑定 this 的指向，才能在其函数体内使用该组件中定义的函数以及属性。对于组件的局部属性，都是统一挂载在 state 中，才能响应状态。</p> <p><strong>二、HTML onclick VS JSX onclick</strong></p> <p>使用 HTML onclick 添加在元素中，主要有以下缺陷：</p> <ul><li>onclick 添加的事件处理函数是在全局环境下执行的，会污染了全局环境；</li> <li>对于使用 onclick 的 DOM 元素，如果动态滴从 DOM 树中删掉的话，还需要相对应滴将其时间处理器注销（所谓时间处理器，就是在事件处理函数中添加有例如 setTimeout 、setInterval 等时间处理器），否则就会导致内存泄漏；</li></ul> <p>而 JSX 中 onClick 事件处理函数中，上述出现的问题都不会出现，其挂载的事件处理函数，都控制在组件范围内，并不会污染到全局空间。同时，React 控制了组件的生命周期，在 unmount 时会自动消除相关的所有的事件处理函数，进而避免内存泄漏。</p> <hr> <blockquote><p>Design React Component</p></blockquote> <p>组件的划分要满足高内聚和低耦合的原则。</p> <ul><li>高内聚：指的是把逻辑紧密相关的内容放在一个组件中；</li> <li>低耦合：指的是不同的组件之间的依赖关系要尽量弱化，也就是每个组件要尽量独立；</li></ul> <p><strong>一、React 组件的数据</strong></p> <ol><li><p>React 组件的数据分为两种：prop 和 state 。prop 或者 state 的改变，都可能引发组件的重新渲染。而<strong>prop 是组件的对外接口，state 是组件的内部状态（即对外用prop，内部用state）</strong>。</p></li> <li><p>一个 React 组件通过定义自己能够接受的 prop 就定义了自己的对外公共接口。举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Button id<span class="token operator">=</span><span class="token string">'button'</span> 
	borderWidth<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token number">2</span> <span class="token punctuation">}</span> 
	onClick<span class="token operator">=</span><span class="token punctuation">{</span> onButtonClick <span class="token punctuation">}</span> 
	style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> style<span class="token punctuation">:</span> <span class="token string">'red'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>HTML 组件属性的值都是字符串类型，当 prop 的类型不是字符串类型时，在 JSX 中必须用花括号 {} 把 prop 的值包住，因此上面 style 属性，外层花括号代表是 JSX 语法，内层则代表是一个对象常量。</p> <p>当 prop 的类型为函数类型时，相当于父组件给子组件一个回调函数，就类似于 Vue 中，<code>props down, events up.</code></p></li> <li><p>React 要求 render 函数只能返回一个元素。</p></li> <li><p>使用 propTypes 可声明自己的接口规范（即规定好每个 prop 应该是怎么养的格式）。举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Counter<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  caption<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span>
  number<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>number
<span class="token punctuation">}</span>
</code></pre></div><p>propTypes 检查只是一个辅助开发的功能，并不会改变组件的行为。定义类的 propTypes 属性，无疑是要占用一些代码空间，而且  propTypes 检查也是要消耗 CPU 计算资源的，因此，<strong>propTypes 只能是建议用在开发环境，不建议用在生产环境</strong>。现有的<code>babel-react-optimize</code>可用于针对生产环境时，自动去掉 propTypes。</p></li> <li><p>组件的 state 必须是一个 Javascript 对象，不能是 string 或 number 类型。当想给组件提供给外部的 Prop 一个默认值时，可以按如下做法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Counter<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  initValue<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token comment">// 这时就可在组件的 state 中直接使用 prop 的默认值</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">:</span> props<span class="token punctuation">.</span>initValue
<span class="token punctuation">}</span>
</code></pre></div><p><strong>更改组件中 state 值时，必须使用 this.setState 方法，不能直接去修改 this.state</strong>。</p> <p>不能直接修改 this.state 值的原因：直接修改 state 对象中的值，不会触发组件进行重新渲染（即 UI 上的值是不会直接响应变化的），而 this.setState 方法则是既改变 this.state 的值，同时也会触发组件重新渲染。</p></li> <li><p>prop 和 state 的区别</p> <ul><li>prop 用于定义外部接口，state 则用于记录内部状态；</li> <li>prop 的赋值在外部世界使用组件时，state 的赋值则在组件的内部；</li> <li>组件不应该改变 prop 的值，而 state 存在的目的就是让组件来改变的；</li></ul></li></ol> <p><strong>二、React 组件生命周期</strong></p> <p>React 的生命周期主要经历如下三个过程：</p> <ul><li>装载过程（Mount）：把组件第一次在 DOM 树中渲染的过程；</li> <li>更新过程（Update）：当组件被重新渲染的过程；</li> <li>卸载过程（Unmount）：组件从 DOM 中删除的过程；</li></ul> <p>每个生命周期过程，都会包含多个生命周期函数，以下就介绍一下：</p> <ol><li><p>装载过程</p> <p>在组件装载的过程中，第一次被渲染时，会依次按顺序调用以下生命周期函数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>constructor <span class="token operator">--</span><span class="token operator">&gt;</span> getInitialState <span class="token operator">--</span><span class="token operator">&gt;</span> getDefaultProps <span class="token operator">--</span><span class="token operator">&gt;</span> componentWillMount <span class="token operator">--</span><span class="token operator">&gt;</span> render <span class="token operator">--</span><span class="token operator">&gt;</span> componentDidMount
</code></pre></div><ul><li><p>constructor</p> <p>一个 React 组件需要构造函数，主要是以下目的：</p> <ul><li><p>初始化 state ；</p></li> <li><p>绑定成员函数的 this 环境（在 ES6 语法下，类的每个成员函数在执行时的 this 并不是和类实例自动绑定的），举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>onClickFun <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClickFun</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

<span class="token comment">// 还有一种方法就是，下面两个冒号::操作符也叫bind操作符</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo
</code></pre></div></li></ul> <p>需注意的是，只有在 ES6 中才会优先调用该生命周期函数，而在 ES5 中则会调用下面 getInitialState 和 getDefaultProps 生命周期函数来进行初始化。</p></li> <li><p>getInitialState 和 getDefaultProps</p> <p>getInitialState 和 getDefaultProps两个方法只在 ES5 中用<code>React.createClass</code>方法创造的组件类才会发生作用。而在 ES6 语法中，则会使用 constructor，这两个函数在其中不会产生作用。</p> <ul><li>getInitialState：该函数的返回值会用来初始化组件的 this.state；</li> <li>getDefaultProps：该函数返回值会作为 props 的初始值；</li></ul> <p>举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 只能使用 ES5 语法才可以使用上述两个方法</span>
<span class="token keyword">const</span> Sample <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">getInitialState</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getDefaultProps</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> sampleProp<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>相比于 ES6 的语法，ES6 则是使用构造函数 constructor 来给 this.state 赋值来完成状态的初始化，并且给类属性 defaultProps 赋值来指定 props 初始值。对比如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 使用 ES6 语法来实现上述的生命周期函数</span>
<span class="token keyword">class</span> <span class="token class-name">Sample</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Sample<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
  	sampleProp<span class="token punctuation">:</span> <span class="token number">0</span>	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>另外，需注意是，getInitialState 只出现在装载过程中，也就是说在一个组件的整个生命周期过程中，该函数只会被调用一次。</p></li> <li><p>render</p> <p><strong>render函数不做实际的渲染动作，它只是返回一个 JSX 描述的结构，最终由 React 来操作渲染过程</strong>。</p> <p>render函数返回一个 null 或者 false 时，相当于告诉 React 该组件这次不需要渲染任何 DOM 元素（可用于提高性能）。</p> <p>render函数是一个纯函数，完全根据 this.state 和 this.props 来决定返回的结果。需要注意的是，<strong>在 render 函数中去调用 this.setState 毫无疑问是错误的，因为一个纯函数不应该引起状态的更改</strong>。</p></li> <li><p>componentWillMount 和 componentDidMount</p> <p><strong>componentWillMount 会在 render 函数之前调用，而 componentDidMount 则会在 render 函数之后被调用</strong>。</p> <p>一般情况下，是不会在 componentWillMount 生命周期函数中做任何操作的，因为该生命周期函数发生在<strong>将要挂载</strong>时。因此建议在 componentWillMount 生命周期中做的事情，都可以提前到 constructor 生命周期函数中来做。</p> <p>至于 componentDidMount 生命周期函数，只有当整个文档中的元素或组件 render 完后，才会按顺序来执行，举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Button 组件</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    conosle<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'constructor: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>num<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentWillMount: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentDidMount: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>num<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>num<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    	<span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>Click Me<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// index</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'./Button'</span>
<span class="token keyword">class</span> <span class="token class-name">ButtonPanel</span> <span class="token keyword">from</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      	<span class="token operator">&lt;</span>Button num<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  			<span class="token operator">&lt;</span>Button num<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button num<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 当执行以上代码后，会发现输出效果</span>
constructor<span class="token punctuation">:</span> <span class="token number">1</span>
componentWillMount<span class="token punctuation">:</span> <span class="token number">1</span>
render<span class="token punctuation">:</span> <span class="token number">1</span>
constructor<span class="token punctuation">:</span> <span class="token number">2</span>
componentWillMount<span class="token punctuation">:</span> <span class="token number">2</span>
render<span class="token punctuation">:</span> <span class="token number">2</span>
constructor<span class="token punctuation">:</span> <span class="token number">3</span>
componentWillMount<span class="token punctuation">:</span> <span class="token number">3</span>
render<span class="token punctuation">:</span> <span class="token number">3</span>
componentDidMount<span class="token punctuation">:</span> <span class="token number">1</span>
componentDidMount<span class="token punctuation">:</span> <span class="token number">2</span>
componentDidMount<span class="token punctuation">:</span> <span class="token number">3</span>
</code></pre></div><p>另外，需要注意的是，<strong>componentWillMount 可在服务器端被调用，也可以在浏览器端被调用</strong>。而 <strong>componentDidMount 则只能在浏览器端被调用</strong>（原因是：&quot;装载过程&quot;即创建 DOM Tree 过程，而在服务端不会产生 DOM Tree，而只是产生最终字符串模版而已）。</p></li></ul></li> <li><p>更新过程</p> <p>在 React 组件的更新过程中，会依次执行以下的更新过程生命周期函数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>componentWillReceiveProps <span class="token operator">--</span><span class="token operator">&gt;</span> shouldComponentUpdate <span class="token operator">--</span><span class="token operator">&gt;</span> componentWillUpdate <span class="token operator">--</span><span class="token operator">&gt;</span> render <span class="token operator">--</span><span class="token operator">&gt;</span> componentDidUpdate
</code></pre></div><p>需注意的是，并不是 React 组件在更新的过程中就会调用上述的所有更新过程生命周期函数，具体看下面：</p> <ul><li><p>componentWillReceiveProps（nextProps）</p> <p><strong>只要父组件的 render 函数被调用</strong>，在 render 函数里面被渲染的子组件就会经历更新过程，同时不管<strong>父组件传给子组件的 props 有没有改变，都会触发子组件的 componentWillReceiveProps 生命周期函数</strong>。</p> <p><strong>使用<code>this.forceUpdate</code>方法可强行引发一次重新绘制</strong>。</p> <p>在 JSX 中用直接把匿名函数赋值给 onClick 的方法，并不是一种提倡方法，因为每次渲染（即调用 render 时）都只会创造一个新的匿名方法对象。</p> <p>componentWillReceiveProps 方法接受一个参数 nextProps ，而 nextProps 代表的是这次渲染传入的 props 值，this.props 代表的上一次渲染时的 props 值。该生命周期函数是有必要把传入参数 nextProps 和 this.props 作对比，然后根据需要来调用 this.setState 方法来更改本组件的对应状态。举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>另外需注意的是，<strong>组件中<code>this.setState</code>的调用，不会触发 componentWillReceiveProps 生命周期函数</strong>。</p></li> <li><p>shouldComponentUpdate（nextProps, nextState）</p> <p>除了 render 函数外，shouldComponentUpdate 可以说是 React 组件生命周期中最重要的一个函数。</p> <p><strong>在更新过程中，React 库会先调用 shouldComponentUpdate 函数，如果这个函数返回 true，那就回继续更新过程（即接下来就会调用 render 函数）；反之，如果返回一个 false，那就立刻停止更新过程，也就不会引发后续的渲染了</strong>。（说 shouldComponentUpdate 重要，是因为对于一些没必要渲染的组件，可不用渲染进而让速度更快）</p> <p>需注意的是，React 中默认定义的 shouldComponentUpdate 函数都是返回 true 的，因此当 nextProps 与 this.props 或者 nextState 与 this.state 不同时，才去进行重新渲染，否则不重新渲染。举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>nextState<span class="token punctuation">.</span>age <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 需注意的是：nextProps针对的是父组件更改props的场景，nextState针对的是组件更改其内部状态的场景</span>
</code></pre></div></li> <li><p>componentWillUpdate 和 componentDidUpdate</p> <p>componentWillUpdate 和 componentDidUpdate 这对函数都是一前一后地把 render 函数夹在中间。（该对函数与 componentWillMount 和 componentDidMount是类似的）。需要注意的是，<strong>componentDidUpdate 函数与 componentDidMount 有一个区别就是，并不是只在浏览器端才执行的，无论更新过程发生在服务器端还是浏览器端，该函数都会被调用</strong>。</p> <p>实际上，使用 React 做服务器端渲染时，基本不会经历更新过程，因为服务器端只需要产生出 HTML 字符串。所以正常情况下服务端不会调用 componentDidUpdate 函数，如果调用了，说明我们的程序有错误需改进。</p></li></ul></li> <li><p>卸载过程</p> <p>React 组件的卸载过程只涉及一个生命周期函数 ComponentWillUnmount 。</p> <p><strong>在 componentDidMount 中用非 React 的方法创造一些 DOM 元素，如果撒手不管可能会造成内存泄漏，那就需要在 componentWillUnmount 中把这些创造的 DOM 元素清理掉</strong>。</p></li></ol> <hr> <blockquote><p>Flux And Redux</p></blockquote> <p>Flux 和 Redux 都是由Facebook在同一时间推出的，可以说，Flux 是作为一个第三方数据管理库，而 redux 则是在 Flux 的基础上改造的数据管理扩展。</p> <p>一、About Flux</p> <p>Flux 主要包含由四个部分：</p> <ul><li><strong>Dispatcher</strong>：处理动作的分发，维持 Store 之间的依赖关系；</li> <li><strong>Store</strong>：负责存储数据和处理数据相关逻辑；</li> <li><strong>Action</strong>：驱动 Dispatcher 的 Javascript 对象；</li> <li><strong>View</strong>：视图部分，负责显示用户界面；</li></ul> <p>示例图如下：</p> <p><img src="https://raw.githubusercontent.com/Andraw-lin/FE-Knowledge-Summary/master/Know-More-About-React/react-flux-structor.png" alt="Flux 示例图"></p> <p>当需要扩充应用所能处理的请求时，MVC方法就需要增加新的 Controller，而对于 Flux 则只是增加新的 Action。直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// AppDispatcher.js（全局定义，用于暴露出去进行分发 action）</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Dispatcher <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'flux'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ActionTypes.js（全局定义，用于定义所有的 action 类型）</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">INCREMENT</span> <span class="token operator">=</span> <span class="token string">'increment'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">DECREMENT</span> <span class="token operator">=</span> <span class="token string">'decrement'</span>

<span class="token comment">// Actions.js（全局定义，利用全局定义 Dispatcher 来分发对应的 action）</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ActionTypes <span class="token keyword">from</span> <span class="token string">'./ActionTypes'</span>
<span class="token keyword">import</span> AppDispatcher <span class="token keyword">from</span> <span class="token string">'./AppDispatcher'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token parameter">counterCaption</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  AppDispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span>
    counterCaption<span class="token punctuation">:</span> counterCaption
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token parameter">counterCaption</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  AppDispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">,</span>
    counterCaption<span class="token punctuation">:</span> counterCaption
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// store/CounterStore.js（用于定义每个数据源 store，同时注册后根据传来的 action 来触发更新 store 中的值）</span>
<span class="token keyword">const</span> counterValues <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'First'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">'Second'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token string">'Third'</span><span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Counter <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">getCounterValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> counterValues
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">emitChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'singleCounter'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">addChangelistener</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'singleCounter'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">removeChangeListener</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">'singleCounter'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Counter<span class="token punctuation">.</span>dispatchToken <span class="token operator">=</span> AppDispatcher<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    counterValue<span class="token punctuation">[</span>action<span class="token punctuation">.</span>counterCaption<span class="token punctuation">]</span><span class="token operator">++</span>
    CounterStore<span class="token punctuation">.</span><span class="token function">emitChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    counterValue<span class="token punctuation">[</span>action<span class="token punctuation">.</span>counterCaption<span class="token punctuation">]</span><span class="token operator">--</span>
    CounterStore<span class="token punctuation">.</span><span class="token function">emitChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// views/Counter.js</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onClickButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClickButton</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> CounterStore<span class="token punctuation">.</span><span class="token function">getCounterValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>props<span class="token punctuation">.</span>caption<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  CounterStore<span class="token punctuation">.</span><span class="token function">addChangeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">)</span>	<span class="token comment">// 为了添加监听事件，用于实时更新View上的数据</span>
<span class="token punctuation">}</span>
<span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  CounterStore<span class="token punctuation">.</span><span class="token function">removeChangeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">)</span>	<span class="token comment">// 同样地，在组件销毁时需要更新对应View上的数据</span>
<span class="token punctuation">}</span>
<span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  	count<span class="token punctuation">:</span> CounterStore<span class="token punctuation">.</span><span class="token function">getCounterValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>props<span class="token punctuation">.</span>caption<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Actions<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>caption<span class="token punctuation">)</span>	<span class="token comment">// 当主动触发行为时，需要进行分发行为</span>
<span class="token punctuation">}</span>
</code></pre></div><p>除了上述的情况，还会存在一种情景，就是在 views 中组件挂载时所添加的 Store 事件监听，Flux 默认并不是根据我们所调用的顺序去执行各个回调函数的，当然我们也无法把握各个 Store 哪个先加载从而调用 register 函数。</p> <p>说白点，就是当我们想在父组件中将每个 Counter 组件中的数值取和时，需要额外增多一个 Store 用于将 CounterStore 中的值进行相加，如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// store/SummaryCounter.js</span>
<span class="token keyword">function</span> <span class="token function">computedCounter</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> summary <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>hasOwnProperty<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> summary <span class="token operator">+=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> summary
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> SummaryCounter <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token function">getSummaryValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token keyword">return</span> <span class="token function">computedCounter</span><span class="token punctuation">(</span>CounterStore<span class="token punctuation">.</span><span class="token function">getCounterValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">emitChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'summaryCounter'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">addChangeListener</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'summaryCounter'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">removeChangeListener</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">'summaryCounter'</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>由于在 Counter 组件中点击 + 按钮后，按我们的理解肯定是，先执行 CounterStore 中的数据源，然后更新完后再去直接执行 SummaryStore 中的数据源。但是上面说过，<strong>Flux 是无法确保每个数据源的真正执行顺序的</strong>，这就需要用到 Flux 中 waitFor 函数来进行等待处理。如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 接着上述的栗子</span>
SummaryCounter<span class="token punctuation">.</span>dispatchToken <span class="token operator">=</span> AppDispatcher<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  AppDispatcher<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">[</span>CounterStore<span class="token punctuation">.</span>dispatchToken<span class="token punctuation">]</span><span class="token punctuation">)</span>
  SummaryStore<span class="token punctuation">.</span><span class="token function">emitChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>waitFor 函数会告诉当前的 SummaryStore ，当前的处理必须要暂停，直到 dispatchToken 代表的那些以注册回调函数执行结束才能继续。</p> <p>接下来，就对比一个 Flux 框架的优缺点：</p> <ol><li>Flux 优势
<ul><li>在 Flux 架构下，应用的状态都被放在了 Store 中，组件只是扮演 View 的作用，被动根据 Store 的状态来渲染；</li> <li><strong>Flux 中最重要的就是“单向数据流”的管理方式</strong>。在 Flux 理念里，若想改变界面，得先改变 Store 中的状态，如果想改变 Store 中的状态，就得必须派发一个 action 对象（相比于 MVC，MVC 最大的问题就是无法禁绝 View 和 Model 之间的直接对话，MVC 中的 View 就是 Flux 中的 View，而其 Model 就是 Flux 中的 Store）。在 Flux 中，Store 只有 get 方法，没有 set 方法，根本无法直接去修改其内部状态，而 View 想要更改 Store 状态的话，只有派发一个 action 对象给 Dispatcher；</li></ul></li> <li>Flux 缺陷
<ul><li><strong>Store 之间的依赖关系</strong>：在 Flux 中，两个 Store 之间有逻辑依赖关系，就必须用上 Dispatcher 的 waitFor 函数，而这就让多个 Store 之间产生了依赖关系；</li> <li><strong>难以进行服务端渲染</strong>：在服务端渲染时，输出的不是一个 DOM Tree，而是一个字符串（即 HTML 字符串）。由于只有一个全局的 Dispatcher，然后每一个 Store 都是一个全局唯一的对象，对于浏览器端来说是没什么问题的，但对于服务器来说简直就是个灾难（因为当服务器同时接受很多用户的请求时，若每个 Store 都是全局唯一的对象，则不同的请求就会很容易出现乱套）。当然官方也说明了，Flux 并不是打算用来服务端使用的。</li> <li><strong>Store 混杂了逻辑和状态</strong>；</li></ul></li></ol> <p>二、About Redux</p> <p>众所周知，Flux 基本原则是<strong>单向数据流</strong>，Redux 在此基础上强调了三个基本原则：</p> <ul><li><p><strong>唯一数据源</strong>（Single Source Of Truth）；</p> <p>应用的状态数据只能存储在唯一的一个 Store 上，Flux 中往往根据功能把应用的状态数据划分给若干个 Store 分别存储管理（造成数据冗余，同时 WaitFor 方法虽染科保证多个 Store 之间更新顺序，但却产生了不同的 Store 之间的依赖），而 Redux 只保持一个 Store，所有组件的数据源就是该 Store 上的状态。</p></li> <li><p><strong>保持状态只读</strong>（State is read-only）；</p> <p>要修改 Store 的状态，必须得通过派发一个 action 对象完成。</p></li> <li><p><strong>数据改变只能通过纯函数完成</strong>（Change are made with pure functions）；</p> <p>通过一个 Reducer 纯函数完成数据改变：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
</code></pre></div><p>第一个参数 state 是当前的状态，第二个参数 action 是接收到的 action 对象，最后根据 state 和 action 的值产生一个新的对象返回。需要注意的是，<strong>不能直接修改参数 state 和 action 对象</strong>。<strong>Redux 的 reducer 只负责计算状态，并不负责存储状态</strong>。</p></li></ul> <p>接下里直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ActionType.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">INCREMENT</span> <span class="token operator">=</span> <span class="token string">'increment'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">DECREMENT</span> <span class="token operator">=</span> <span class="token string">'decrement'</span>

<span class="token comment">// Actions.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ActionTypes <span class="token keyword">from</span> <span class="token string">'./ActionType'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token parameter">counterCaption</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span>
	counterCaption<span class="token punctuation">:</span> counterCaption
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token parameter">counterCaption</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">,</span>
  counterCaption<span class="token punctuation">:</span> counterCaption
<span class="token punctuation">}</span>

<span class="token comment">// Reducer.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ActionTypes <span class="token keyword">from</span> <span class="token string">'./ActionType'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 	<span class="token keyword">const</span> <span class="token punctuation">{</span> counterCaption <span class="token punctuation">}</span> <span class="token operator">=</span> action
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token punctuation">[</span>counterCaption<span class="token punctuation">]</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>counterCaption<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token keyword">case</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token punctuation">[</span>counterCaption<span class="token punctuation">]</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>counterCaption<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Store.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> Reducer <span class="token keyword">from</span> <span class="token string">'./Reducer'</span>
<span class="token keyword">const</span> initValues <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 创建原始数据源</span>
	<span class="token string">'First'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">'Second'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token string">'Third'</span><span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span>Reducer<span class="token punctuation">,</span> initValues<span class="token punctuation">)</span> <span class="token comment">// 将 Reducer 与原始数据源建立关系</span>

<span class="token comment">// views/ClickButton.js</span>
<span class="token keyword">import</span> Store <span class="token string">'../Store'</span>
<span class="token keyword">import</span> Actions <span class="token keyword">from</span> <span class="token string">'../Actions'</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onClickButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClickButton</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
    counterNum<span class="token punctuation">:</span> Store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>props<span class="token punctuation">.</span>counterCaption<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">componentWillUnMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Store<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	Store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>Actions<span class="token punctuation">.</span>increment<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    counterNum<span class="token punctuation">:</span> Store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>props<span class="token punctuation">.</span>counterCaption<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// views/SummaryCounter.js（接下来的计算总值组件就不需要再定一个新的 Store 了）</span>
<span class="token keyword">import</span> Store <span class="token keyword">from</span> <span class="token string">'../Store'</span>
<span class="token function">consturctor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>getSummaryCounter <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSummaryCounter</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
    summaryCounter<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSummaryCounter</span><span class="token punctuation">(</span>Store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Store<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">getSummaryCounter</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> summary <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	summary <span class="token operator">+=</span> state<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> summary
<span class="token punctuation">}</span>
<span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    summaryCounter<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSummaryCounter</span><span class="token punctuation">(</span>Store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>三、容器组件和傻瓜组件</p> <p>所谓的容器组件和傻瓜组件，就是：</p> <ul><li>容器组件：承担第一个任务的组件，也就是负责和 Redux Store 打交道以及数据初始化、方法定义等功能的组件，处于外层（也叫聪明组件）；</li> <li>傻瓜组件：承担第二个任务的组件，也就是负责渲染界面的组件，处于内层（一般来说，只负责 UI）；</li></ul> <p>示例图如下：</p> <p><img src="https://raw.githubusercontent.com/Andraw-lin/FE-Knowledge-Summary/master/Know-More-About-React/container-component-and-follish-component.png" alt="容器组件和傻瓜组件"></p> <p>举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// views/Counter.js</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> caption<span class="token punctuation">,</span> onIncrement<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onIncrement<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    		<span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>caption<span class="token punctuation">}</span> count<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">CounterContainer</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    	<span class="token operator">&lt;</span>Counter caption<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>caption<span class="token punctuation">}</span>
  			onIncrement<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onIncrement<span class="token punctuation">}</span>
				onDecrement<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onDecrement<span class="token punctuation">}</span>
				value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">}</span>
  		<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> CounterContainer
</code></pre></div><p>可以看到，Counter 组件完全没有 state，只有一个 render 方法，所有的数据都来自于 props，也叫<strong>无状态组件</strong>。而 CounterContainer 组件承担了所有的和 Store 关联的工作，它的 render 函数所做的就是渲染傻瓜组件 Counter 而已，只负责传递必要的 props 即可。</p> <p>当然，无状态组件还可以进一步缩减代码，用一个函数代表如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>caption<span class="token punctuation">,</span> onIncrement<span class="token punctuation">,</span> onDecrement<span class="token punctuation">,</span> value<span class="token punctuation">}</span> <span class="token operator">=</span> props
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
  	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    	<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onIncrement<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>caption<span class="token punctuation">}</span> count<span class="token punctuation">:</span> <span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>四、About React-Redux</p> <p>由上述的 Redux 栗子可以看到，当组件需要用到 Store 时，就需要引入 Store，并且需要在组件挂载后开始订阅对应的事件数据的变化，无疑中就产生了代码的冗余。为了避免这些尴尬的情况，才有了<code>react-redux</code>包装库产生。</p> <p>简单滴说，react-redux 就是 redux 的一个语法糖，它可以很方便地让初学者适用。同时，<strong>react-redux 的实现就是通过 context 和 容器傻瓜组件实现的</strong>。话不多说，直接上栗子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Store.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> Reducer <span class="token keyword">from</span> <span class="token string">'./Reducer'</span>
<span class="token keyword">import</span> 
<span class="token keyword">const</span> initValue <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 定义数据源</span>
  <span class="token string">'First'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">'Second'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token string">'Thrid'</span><span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span>Reducer<span class="token punctuation">,</span> initValue<span class="token punctuation">)</span>

<span class="token comment">// Reducer.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ActionTypes <span class="token keyword">from</span> <span class="token string">'./ActionType'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 	<span class="token keyword">const</span> <span class="token punctuation">{</span> counterCaption <span class="token punctuation">}</span> <span class="token operator">=</span> action
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token punctuation">[</span>counterCaption<span class="token punctuation">]</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>counterCaption<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token keyword">case</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token punctuation">[</span>counterCaption<span class="token punctuation">]</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>counterCaption<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ActionTypes.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">INCREMENT</span> <span class="token operator">=</span> <span class="token string">'increment'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">DECREMENT</span> <span class="token operator">=</span> <span class="token string">'decrement'</span>

<span class="token comment">// Actions.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ActionTypes <span class="token keyword">from</span> <span class="token string">'./ActionType'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token parameter">counterCaption</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span>
	counterCaption<span class="token punctuation">:</span> counterCaption
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token parameter">counterCaption</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> ActionTypes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">,</span>
  counterCaption<span class="token punctuation">:</span> counterCaption
<span class="token punctuation">}</span>

<span class="token comment">// ClickCounter.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Action <span class="token keyword">from</span> <span class="token string">'./Actions.js'</span>
<span class="token keyword">class</span> <span class="token class-name">ClickCounter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button onClickButton<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onClickButton <span class="token punctuation">}</span>  <span class="token operator">/</span><span class="token operator">&gt;</span>
        Click Count<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count <span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>ClickCounter<span class="token punctuation">)</span>
<span class="token comment">// 需要说明的是，mapStateToProps作为一个数据源接口，其中 state 相当于 Store.getState(), ownProps 则是上级父组件传给该组件的 Props（即相当于一个中介者）</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> state<span class="token punctuation">[</span>ownProps<span class="token punctuation">.</span>counterCaption<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 同样是，mapDispatchToProps 就是相当于动作的执行的包装（也是可以看成一个中介者）,其中 dispatch 就是 Store 中dispatch 方法，ownProps 同上</span>
<span class="token keyword">const</span> <span class="token function">mapDispatchToProps</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">onClickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span>Action<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>ownProps<span class="token punctuation">.</span>counterCaption<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span> 
<span class="token keyword">import</span> Store form <span class="token string">'./Store'</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>Store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ConnectCounterPanel <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过上述的栗子，也许你会有疑惑，因为在上面的 redux 栗子中，当 Store 数据更改时，订阅到该数据源的组件都会直接调用一个 callback的，但是现在使用 react-redux 该何去何从呢？</p> <p>其实一样好简单，就是当数据源改变时，mapStateToProps 方法都会被调用，也即是该方法除了中介者作用外，还作为一个订阅方法所用。</p> <p>最后，可以总结出，<strong>使用 react-redux 的两个重要点就是：Provider 和 connect 方法</strong>。其中 Provider 的作用就是作为一个 context，然后把数据源传递下去，而 connect 方法则是使组件按需引入数据源并且订阅作用。</p> <hr> <blockquote><p>React 组件性能优化</p></blockquote> <p>在日常开发中，推荐的依然是，<strong>一个组件如果能够在开头计算 Virtual DOM 之前就可以判断渲染结果不会有变化，那样就不必要进行 Virtual DOM 来计算和比较</strong>。</p> <p>一、单个组件渲染优化</p> <p>React 中 shouldComponentUpdate 生命周期默认是返回 false 的，若需要检测到组件传入的 Props 并没有改变时，就没必要进行重新渲染比较了，举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>completed <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>completed<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>text <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方法很简单，只需要判断当下旧有的 props 和 新的 props 中属性是否相等即可决定是否要重新渲染比较了。</p> <p>上述方法，针对一个简单组件来说会很简单，但是对于一个拥有多个复杂 props 的组件来说就是，就会写的很麻烦。<strong>而 react-redux 库中 connect 方法默认就是实现了所有比较</strong>。</p> <p><strong>connect 的过程中实际上产生了一个无名的 React 组件类，而这个类定制了 shouldCompnentUpdate 函数的实现，实现逻辑是比这次传递给内层傻瓜组件的 Props 和 上一次的 Props</strong>。语法简单滴就可以写成如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ClickCounter<span class="token punctuation">)</span>
</code></pre></div><p>使用 connect 来包裹组件的唯一目的，就是利用那个聪明的 shouldComponentUpdate 函数。</p> <p>但是，在 react-redux 的实现 shouldComponentUpdate 的方式，就是：<strong>做的就是“浅层比较”，即用 JavaScript 的 === 操作符来进行比较，如果 prop 的类型是字符串或者数字，只要值相同即可，而对于复杂对象，则只会判断这两个 prop 是不是同一个对象的引用，如果不是则会被认为是两个不同的 prop</strong>。为解决上述的问题，需设置<strong>保证 prop 是指向同一个 JavaScript 对象</strong>。举个栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 以下情况会导致重新执行更新</span>
<span class="token operator">&lt;</span>Foo style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">'red'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  
<span class="token comment">// 需改成下面情况即可，引用相同的对象即可</span>
<span class="token keyword">const</span> fooStyle <span class="token operator">=</span> <span class="token punctuation">{</span>color<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>Foo style<span class="token operator">=</span><span class="token punctuation">{</span> fooStyle <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>当然，对于 prop 为函数类型都需要指向同一个 Function ，否则都会导致更新。有两种方式来处理：</p> <ul><li><p>通过 mapDispatchToProps 设置中间函数</p> <p>直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Item 
	key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
	id<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
	text<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span>
	completed<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>completed<span class="token punctuation">}</span>
	onToggle<span class="token operator">=</span><span class="token punctuation">{</span>onToggleFun<span class="token punctuation">}</span>
	onRemove<span class="token operator">=</span><span class="token punctuation">{</span>onRemoveFun<span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">onToggleItem</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ownProps<span class="token punctuation">.</span><span class="token function">onToggle</span><span class="token punctuation">(</span>ownProps<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>当父组件进行更新时，由于父组件都会传入一个新的函数给到 Item 组件，这样就会直接导致 Item 不可避免滴更新。而 mapDispatchToProps 设置中间函数后，都会引用同一个函数从而避免 Item 组件更新。</p></li> <li><p>不用父组件传递操作函数，而是直接通过组件自己搞定</p> <p>实质上也是通过 mapDispatchToProps 进行实现，直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Item 
	key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
	id<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
	text<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span>
	completed<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>completed<span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> ownProps
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onToggle</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">toggleTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onRemove</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">removeTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>推荐方式为第二种方法，因符合高内聚的要求。</p></li></ul> <p>二、Key 优化</p> <p>当遍历一个数组进行输出对应数据时，为了避免在进行遍历组件 Item 随着数组中数据的更改而更新，就需要添加一个唯一的 Key 值来让计算识别出来，直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 未添加元素前</span>
<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> text<span class="token operator">=</span><span class="token string">&quot;First&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> text<span class="token operator">=</span><span class="token string">&quot;Second&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>

<span class="token comment">// 添加元素后</span>
<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> text<span class="token operator">=</span><span class="token string">&quot;Third&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span> text<span class="token operator">=</span><span class="token string">&quot;First&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span> text<span class="token operator">=</span><span class="token string">&quot;Second&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre></div><p>由于上面使用 key 后，React 会根据 Key 值来判断是否有变化，一旦没有就不会更新组件，明显滴，上述例子在添加元素后，key 值为1和2的组件都不会跟着改变。</p> <p>三、通过 reselect 来提高获取数据的性能</p> <p>reselect 库实质上是用于缓存第一次获取的数据，当第二次调用后，会判断当前数据和缓存的数据是否变化，一旦没变化就会直接返回。<a href="https://github.com/reduxjs/reselect" target="_blank" rel="noopener noreferrer">github传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <hr> <blockquote><p>高阶组件</p></blockquote> <p>一个高阶组件就是一个函数，该函数<strong>接受一个组件作为输入</strong>，然后<strong>返回一个新的组件作为结果</strong>。而且，返回的新数组拥有了输入组件所不具有的功能。直接上栗子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">function</span> <span class="token function">highComponent</span><span class="token punctuation">(</span><span class="token parameter">MyComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">MyNewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>user<span class="token punctuation">,</span> <span class="token operator">...</span>otherProps<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
      	<span class="token operator">&lt;</span>MyComponent <span class="token punctuation">{</span><span class="token operator">...</span>otherProps<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义高阶组件的意义主要体现在：</p> <ul><li><p>重用代码；</p> <p>当多个组件共用一个逻辑时，就没必要每个组件都实现一遍，类似于 Minxin 功能。</p></li> <li><p>修改现有 React 组件行为；</p> <p>通过一个独立于原有组件的函数，可以产生新的组件，对原有组件没任何侵害。</p></li></ul> <p>另外，高阶组件的实现方式有两种：</p> <ol><li><p>代理方式的高阶组件；</p></li> <li><p>继承方式的高阶组件；</p></li></ol> <p>一、代理方式的高阶组件</p> <p><strong>代理方式的高阶组件，主要用于以下场景：操纵 props、访问ref、抽取状态、包装组件</strong>。代理方式的特点就是返回的新组件类型直接继承自 React.Component 类，另外在新组建的 render 函数中，把被包裹组件渲染出来。</p> <ul><li><p>操纵 props；</p> <p>在 render 函数中，this.props 包含新组件接收到的所有 props，直接上栗子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">addNewProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">MyComponent<span class="token punctuation">,</span> newProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">MyNewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>MyComponent <span class="token punctuation">{</span><span class="token operator">...</span>this<span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>newProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>访问 ref；</p> <p>需注意的是，访问 ref 不是值得推荐的 React 组件使用方式。直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">refsHOC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">MyComponent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">HOCComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>linkRef <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">linkRef</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">linkRef</span><span class="token punctuation">(</span><span class="token parameter">myComponentInstance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_root <span class="token operator">=</span> myComponentInstance
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>this<span class="token punctuation">.</span>props<span class="token punctuation">,</span> ref<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>linkRef<span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>myComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>抽取状态；</p> <p>所谓的抽取状态，就是让傻瓜组件不要管理自己的状态，只要做一个无状态的组件就好，所有状态的管理都交给外面的容器组件。主要通过闭包来实现。直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">doNothing</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token operator">=</span>doNothing<span class="token punctuation">,</span> mapDispatchToProps<span class="token operator">=</span>doNothing</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">MyComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">HOCComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
      <span class="token comment">// 这里定义 HOCComponent 的生命周期函数</span>
    <span class="token punctuation">}</span>
    HOCComponent<span class="token punctuation">.</span>contextType <span class="token operator">=</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>object
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> HOCComponent
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述栗子实现的是仿 react-redux 中一个简约版的 connect 方法，其中 MyComponent 就是一个傻瓜组件，只专注于渲染，而在闭包里的 HOCComponent 则是作为一个容器组件进行逻辑处理。</p></li> <li><p>包装组件；</p> <p>render 函数的 JSX 中完全可以引入其他元素，甚至可以组合多个 React 组件。直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">styleHOC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">MyComponent<span class="token punctuation">,</span> style</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">HOCComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
      	<span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        	<span class="token operator">&lt;</span>MyComponent <span class="token punctuation">{</span><span class="token operator">...</span>this<span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用时</span>
<span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span>color<span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> NewComponent <span class="token operator">=</span> <span class="token function">styleHOC</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> style<span class="token punctuation">)</span>
</code></pre></div><p>包装组件的栗子跟操作 Props 是差不多的思路。</p></li></ul> <p>二、继承方式的高阶组件</p> <p>继承方式的高阶组件采用继承关系关联作为参数的组件和返回组件，假如传入的组件参数是 MyComponent，那么返回的组件就直接继承自 MyComponent 组件。直接看一个跟简单的栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">MyNewComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">MyComponent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">NewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">MyComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>user<span class="token punctuation">,</span> <span class="token operator">...</span>otherProps<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> otherProps
      <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>代理方式和继承方式最大的区别，就是代理方式是包裹传入的组件返回新组件，而继承则是继承传入组件来返回新组件</strong>。需注意的是，代理方式下，返回新组件是如下返回：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">return</span> <span class="token operator">&lt;</span>MyComponent <span class="token punctuation">{</span><span class="token operator">...</span>this<span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>而对于继承模式，则是按如下进行返回新组件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>在代理方式下产生的新组件和参数组件是两个不同的组件，一次渲染，两个组件都要经历各自的生命周期。而在继承方式下两者合二为一，只有一个生命周期</strong>。</p> <p>继承方式的高阶组件可以应用以下场景：</p> <ol><li><p>操作 prop</p> <p>对于操作 prop，官方是推荐使用代理方式来进行，而对于继承方式只有一个场景是用得上的，就是高阶组件需根据参数组件 MyComponent 渲染结果来决定如何修改 prop。直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">modifyComponent</span> <span class="token operator">=</span> <span class="token parameter">MyComponent</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">MyNewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">MyComponent</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> elements <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span>
        color<span class="token punctuation">:</span> elements <span class="token operator">&amp;&amp;</span> elements<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'div'</span> <span class="token operator">?</span> <span class="token string">'red'</span> <span class="token punctuation">:</span> <span class="token string">'orange'</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>this<span class="token punctuation">.</span>props<span class="token punctuation">,</span>
        style<span class="token punctuation">:</span> style
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> props<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>cloneElement 方法用于复制指定组件，其实还有第三个可选参数，就是为新生成的 React 元素添加子元素，进而取替掉原有的子元素。</p></li> <li><p>操作生命周期函数</p> <p>上面提到过，新生成组件和参数组件会合二为一，只有一个生命周期，所以可以重新定义任何一个 React 组件的生命周期（相当于重写）。而代理方式无法则无法修改传入组件的生命周期函数。直接上栗子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">cacheHOC</span> <span class="token operator">=</span> <span class="token parameter">MyComponent</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">MyNewComponent</span> <span class="token keyword">extends</span> <span class="token class-name">MyComponent</span> <span class="token punctuation">{</span>
    <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">!</span>nextProps<span class="token punctuation">.</span>useCache
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>loggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述栗子，就是直接重写了 shouldComponentUpdate 生命周期函数。不过，<strong>官方推荐的是，优先考虑组合，然后才考虑继承</strong>。</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/keep-Learning/assets/js/app.90ccec97.js" defer></script><script src="/keep-Learning/assets/js/2.71580b53.js" defer></script><script src="/keep-Learning/assets/js/80.a48aa37a.js" defer></script>
  </body>
</html>
