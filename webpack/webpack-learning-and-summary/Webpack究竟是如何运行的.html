<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack 究竟是如何运行的？ | Learing And Sharing</title>
    <meta name="description" content="好好学习，天天向上💪">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/keep-Learning/assets/css/0.styles.69d11f16.css" as="style"><link rel="preload" href="/keep-Learning/assets/js/app.90ccec97.js" as="script"><link rel="preload" href="/keep-Learning/assets/js/2.71580b53.js" as="script"><link rel="preload" href="/keep-Learning/assets/js/112.e07a4e74.js" as="script"><link rel="prefetch" href="/keep-Learning/assets/js/10.99f30dcf.js"><link rel="prefetch" href="/keep-Learning/assets/js/100.53100d9a.js"><link rel="prefetch" href="/keep-Learning/assets/js/101.02f72051.js"><link rel="prefetch" href="/keep-Learning/assets/js/102.60bb996e.js"><link rel="prefetch" href="/keep-Learning/assets/js/103.c7f3df5b.js"><link rel="prefetch" href="/keep-Learning/assets/js/104.e8378220.js"><link rel="prefetch" href="/keep-Learning/assets/js/105.90235e89.js"><link rel="prefetch" href="/keep-Learning/assets/js/106.f4905ea3.js"><link rel="prefetch" href="/keep-Learning/assets/js/107.02dfbd1b.js"><link rel="prefetch" href="/keep-Learning/assets/js/108.e4ffed8c.js"><link rel="prefetch" href="/keep-Learning/assets/js/109.2f6191db.js"><link rel="prefetch" href="/keep-Learning/assets/js/11.ccfc084d.js"><link rel="prefetch" href="/keep-Learning/assets/js/110.05776fb6.js"><link rel="prefetch" href="/keep-Learning/assets/js/111.b05f070d.js"><link rel="prefetch" href="/keep-Learning/assets/js/113.71af1d2b.js"><link rel="prefetch" href="/keep-Learning/assets/js/114.914195f4.js"><link rel="prefetch" href="/keep-Learning/assets/js/115.3a0e92aa.js"><link rel="prefetch" href="/keep-Learning/assets/js/116.4ab80baa.js"><link rel="prefetch" href="/keep-Learning/assets/js/12.5bee8056.js"><link rel="prefetch" href="/keep-Learning/assets/js/13.05de0df0.js"><link rel="prefetch" href="/keep-Learning/assets/js/14.d86b4a20.js"><link rel="prefetch" href="/keep-Learning/assets/js/15.887efa99.js"><link rel="prefetch" href="/keep-Learning/assets/js/16.f7c7fa8d.js"><link rel="prefetch" href="/keep-Learning/assets/js/17.dbf7a65f.js"><link rel="prefetch" href="/keep-Learning/assets/js/18.e57690bf.js"><link rel="prefetch" href="/keep-Learning/assets/js/19.7486ada7.js"><link rel="prefetch" href="/keep-Learning/assets/js/20.d9250e4c.js"><link rel="prefetch" href="/keep-Learning/assets/js/21.71046546.js"><link rel="prefetch" href="/keep-Learning/assets/js/22.5d1bafeb.js"><link rel="prefetch" href="/keep-Learning/assets/js/23.06f0e746.js"><link rel="prefetch" href="/keep-Learning/assets/js/24.2d27300f.js"><link rel="prefetch" href="/keep-Learning/assets/js/25.08ee3872.js"><link rel="prefetch" href="/keep-Learning/assets/js/26.b747bff1.js"><link rel="prefetch" href="/keep-Learning/assets/js/27.895e5c28.js"><link rel="prefetch" href="/keep-Learning/assets/js/28.8674bd28.js"><link rel="prefetch" href="/keep-Learning/assets/js/29.00b3c0e2.js"><link rel="prefetch" href="/keep-Learning/assets/js/3.227fd7b0.js"><link rel="prefetch" href="/keep-Learning/assets/js/30.7c8a2e90.js"><link rel="prefetch" href="/keep-Learning/assets/js/31.4e94fa86.js"><link rel="prefetch" href="/keep-Learning/assets/js/32.24db43de.js"><link rel="prefetch" href="/keep-Learning/assets/js/33.3a9d7c5b.js"><link rel="prefetch" href="/keep-Learning/assets/js/34.455ff1fa.js"><link rel="prefetch" href="/keep-Learning/assets/js/35.bf04ef16.js"><link rel="prefetch" href="/keep-Learning/assets/js/36.f733bfb6.js"><link rel="prefetch" href="/keep-Learning/assets/js/37.507ec8ee.js"><link rel="prefetch" href="/keep-Learning/assets/js/38.4c8024fc.js"><link rel="prefetch" href="/keep-Learning/assets/js/39.e5094649.js"><link rel="prefetch" href="/keep-Learning/assets/js/4.c62e84b3.js"><link rel="prefetch" href="/keep-Learning/assets/js/40.6dd7a473.js"><link rel="prefetch" href="/keep-Learning/assets/js/41.14db9a5d.js"><link rel="prefetch" href="/keep-Learning/assets/js/42.342c49d2.js"><link rel="prefetch" href="/keep-Learning/assets/js/43.e2f02df0.js"><link rel="prefetch" href="/keep-Learning/assets/js/44.85c43572.js"><link rel="prefetch" href="/keep-Learning/assets/js/45.2d71b584.js"><link rel="prefetch" href="/keep-Learning/assets/js/46.26841be2.js"><link rel="prefetch" href="/keep-Learning/assets/js/47.2be49ff6.js"><link rel="prefetch" href="/keep-Learning/assets/js/48.b0982983.js"><link rel="prefetch" href="/keep-Learning/assets/js/49.0160ec63.js"><link rel="prefetch" href="/keep-Learning/assets/js/5.c9cb8de9.js"><link rel="prefetch" href="/keep-Learning/assets/js/50.d1a3af12.js"><link rel="prefetch" href="/keep-Learning/assets/js/51.a655886f.js"><link rel="prefetch" href="/keep-Learning/assets/js/52.93851e74.js"><link rel="prefetch" href="/keep-Learning/assets/js/53.c8009c28.js"><link rel="prefetch" href="/keep-Learning/assets/js/54.7945804f.js"><link rel="prefetch" href="/keep-Learning/assets/js/55.0d1b82a0.js"><link rel="prefetch" href="/keep-Learning/assets/js/56.ea4f3968.js"><link rel="prefetch" href="/keep-Learning/assets/js/57.c7fe55e7.js"><link rel="prefetch" href="/keep-Learning/assets/js/58.e2e1b6dd.js"><link rel="prefetch" href="/keep-Learning/assets/js/59.195b09a3.js"><link rel="prefetch" href="/keep-Learning/assets/js/6.7294f365.js"><link rel="prefetch" href="/keep-Learning/assets/js/60.b0c6ca2b.js"><link rel="prefetch" href="/keep-Learning/assets/js/61.d8137606.js"><link rel="prefetch" href="/keep-Learning/assets/js/62.354a6c3b.js"><link rel="prefetch" href="/keep-Learning/assets/js/63.42a16259.js"><link rel="prefetch" href="/keep-Learning/assets/js/64.44130cd9.js"><link rel="prefetch" href="/keep-Learning/assets/js/65.826334d1.js"><link rel="prefetch" href="/keep-Learning/assets/js/66.39bd2327.js"><link rel="prefetch" href="/keep-Learning/assets/js/67.89147bbe.js"><link rel="prefetch" href="/keep-Learning/assets/js/68.a7602bd4.js"><link rel="prefetch" href="/keep-Learning/assets/js/69.028f1340.js"><link rel="prefetch" href="/keep-Learning/assets/js/7.a9fa44ec.js"><link rel="prefetch" href="/keep-Learning/assets/js/70.3bb91667.js"><link rel="prefetch" href="/keep-Learning/assets/js/71.65fb15dd.js"><link rel="prefetch" href="/keep-Learning/assets/js/72.00066c85.js"><link rel="prefetch" href="/keep-Learning/assets/js/73.47b522ff.js"><link rel="prefetch" href="/keep-Learning/assets/js/74.7a6ef089.js"><link rel="prefetch" href="/keep-Learning/assets/js/75.b187d3a1.js"><link rel="prefetch" href="/keep-Learning/assets/js/76.88a347ac.js"><link rel="prefetch" href="/keep-Learning/assets/js/77.6f86a34a.js"><link rel="prefetch" href="/keep-Learning/assets/js/78.d0ed26d6.js"><link rel="prefetch" href="/keep-Learning/assets/js/79.83c1ce53.js"><link rel="prefetch" href="/keep-Learning/assets/js/8.acbc06dd.js"><link rel="prefetch" href="/keep-Learning/assets/js/80.a48aa37a.js"><link rel="prefetch" href="/keep-Learning/assets/js/81.6eacd104.js"><link rel="prefetch" href="/keep-Learning/assets/js/82.25ef373b.js"><link rel="prefetch" href="/keep-Learning/assets/js/83.09550954.js"><link rel="prefetch" href="/keep-Learning/assets/js/84.e8671abc.js"><link rel="prefetch" href="/keep-Learning/assets/js/85.b1b7d209.js"><link rel="prefetch" href="/keep-Learning/assets/js/86.d297bac9.js"><link rel="prefetch" href="/keep-Learning/assets/js/87.eeea66b3.js"><link rel="prefetch" href="/keep-Learning/assets/js/88.0ea72a36.js"><link rel="prefetch" href="/keep-Learning/assets/js/89.4155e98e.js"><link rel="prefetch" href="/keep-Learning/assets/js/9.ad2f8d07.js"><link rel="prefetch" href="/keep-Learning/assets/js/90.611a7011.js"><link rel="prefetch" href="/keep-Learning/assets/js/91.e84d85cf.js"><link rel="prefetch" href="/keep-Learning/assets/js/92.30b75a79.js"><link rel="prefetch" href="/keep-Learning/assets/js/93.0ccb8db1.js"><link rel="prefetch" href="/keep-Learning/assets/js/94.f5e0fbaf.js"><link rel="prefetch" href="/keep-Learning/assets/js/95.7e23aad8.js"><link rel="prefetch" href="/keep-Learning/assets/js/96.654c8e0c.js"><link rel="prefetch" href="/keep-Learning/assets/js/97.b65e23fb.js"><link rel="prefetch" href="/keep-Learning/assets/js/98.e14a8d6c.js"><link rel="prefetch" href="/keep-Learning/assets/js/99.e2ce5525.js">
    <link rel="stylesheet" href="/keep-Learning/assets/css/0.styles.69d11f16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/keep-Learning/" class="home-link router-link-active"><!----> <span class="site-name">Learing And Sharing</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/keep-Learning/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分享" class="dropdown-title"><span class="title">技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/keep-Learning/javascript/javascript-learning-and-summary/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/html/html-learning-and-summary/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/css/css-learning-and-summary/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/webpack/webpack-learning-and-summary/" class="nav-link router-link-active">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/ts/ts-learning-and-summary/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/nodejs/nodejs-learning-and-summary/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/weex/weex-learning-and-summary/" class="nav-link">
  Weex
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/network/network-learning-and-summary/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/datastructure/datastructure-learning-and-summary/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/mixin/mixin-learning-and-summary/" class="nav-link">
  日常杂记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Andraw-lin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/keep-Learning/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分享" class="dropdown-title"><span class="title">技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/keep-Learning/javascript/javascript-learning-and-summary/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/html/html-learning-and-summary/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/css/css-learning-and-summary/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/webpack/webpack-learning-and-summary/" class="nav-link router-link-active">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/ts/ts-learning-and-summary/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/nodejs/nodejs-learning-and-summary/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/weex/weex-learning-and-summary/" class="nav-link">
  Weex
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/network/network-learning-and-summary/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/datastructure/datastructure-learning-and-summary/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/keep-Learning/mixin/mixin-learning-and-summary/" class="nav-link">
  日常杂记
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Andraw-lin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/keep-Learning/webpack/webpack-learning-and-summary" class="sidebar-heading clickable router-link-active open"><span>Webpack 学习和总结</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack究竟是如何运行的.html" class="active sidebar-link">Webpack究竟是如何运行的</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack究竟是如何运行的.html#现代构建工具对比" class="sidebar-link">现代构建工具对比</a></li><li class="sidebar-sub-header"><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack究竟是如何运行的.html#webpack构建流程" class="sidebar-link">Webpack构建流程</a></li><li class="sidebar-sub-header"><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack究竟是如何运行的.html#理解-loader" class="sidebar-link">理解 Loader</a></li><li class="sidebar-sub-header"><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack究竟是如何运行的.html#理解-plugin" class="sidebar-link">理解 Plugin</a></li></ul></li><li><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack优化--构建速度篇.html" class="sidebar-link">Webpack优化--构建速度篇</a></li><li><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack优化--开发体验篇.html" class="sidebar-link">Webpack优化--开发体验篇</a></li><li><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack优化--输出质量篇.html" class="sidebar-link">Webpack优化--输出质量篇</a></li><li><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack之模块化优化.html" class="sidebar-link">Webpack之模块化优化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-究竟是如何运行的？"><a href="#webpack-究竟是如何运行的？" class="header-anchor">#</a> Webpack 究竟是如何运行的？</h1> <p>在日常开发过程中，我们是需要经常将心思放在如何使用 Webpack 优化开发体验以及输出的质量，却很少把目光放在 Webpack 的启动流程、loader 和 plugin 基本原理等等方面上。</p> <p>那么，现在我们就来一起来简单缕一缕，究竟 Webpack 是怎么运行的？以及 loader 和 plugin 又是如何工作的？</p> <h2 id="现代构建工具对比"><a href="#现代构建工具对比" class="header-anchor">#</a> 现代构建工具对比</h2> <p>在探究之前，我个人觉得是很有必要说一说的，那就是现代构建工对比。为什么？</p> <p>在前端快速发展的这几年，如何高效滴构建项目变得越来越重要，但是在百花争艳的构建工具里面，究竟是选用哪一款？那么现代构建工具有那么多，肯定得有它们适用场合，因此了解它们也是很有必要的。🤔</p> <p>今天要讲的现代工具，主要是 <strong>NPM Script、Grunt、Glup、Fis3、Webpack、Rollup</strong>。下面我就来看看它们究竟是用来干啥的。</p> <blockquote><p>NPM Script</p></blockquote> <p>如果你用过 package.json，那么你对它肯定不陌生。<strong>NPM Script 是 NPM 内置的一个功能，允许在 package.json 文件里面使用 scripts 字段定义的任务</strong>。举个🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;node main.js&quot;</span><span class="token punctuation">,</span>
 		<span class="token string">&quot;prod&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;node prod.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在定义上述的任务后，我们就可以直接在项目根路径下执行如下命令：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm start
</code></pre></div><p><strong>执行 NPM 相应的命令后，会根据 package.json 执行命令对应的任务</strong>。</p> <p>毫无疑问，<strong>NPM Script 的优点就是内置，无需安装其他依赖，缺点就是功能太简单，不能方便滴管理多个任务之间的依赖</strong>。</p> <blockquote><p>Grunt</p></blockquote> <p>Grunt 和 NPM Script 一样，都只是一个任务执行者。但相比之下，<strong>Grunt 有着大量现成的插件封装了常见的任务，也能管理任务之间的依赖关系，并能自动化滴执行依赖的任务</strong>，每个任务的具体代码和依赖关系写在 Gruntfile.js 里。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">grunt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// Project configuration.</span>
  grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    pkg<span class="token punctuation">:</span> grunt<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">readJSON</span><span class="token punctuation">(</span><span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    uglify<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        banner<span class="token punctuation">:</span> <span class="token string">'/*! &lt;%= pkg.name %&gt; &lt;%= grunt.template.today(&quot;yyyy-mm-dd&quot;) %&gt; */\n'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      build<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        src<span class="token punctuation">:</span> <span class="token string">'src/&lt;%= pkg.name %&gt;.js'</span><span class="token punctuation">,</span>
        dest<span class="token punctuation">:</span> <span class="token string">'build/&lt;%= pkg.name %&gt;.min.js'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Load the plugin that provides the &quot;uglify&quot; task.</span>
  grunt<span class="token punctuation">.</span><span class="token function">loadNpmTasks</span><span class="token punctuation">(</span><span class="token string">'grunt-contrib-uglify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Default task(s).</span>
  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'uglify'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在项目根目录执行命令 grunt，就会启动 uglify 功能对指定的 JavaScript 文件进行压缩，上述配置中还从源文件 package.json 中读取信息。</p> <p><strong>Grunt 最大的优点在于能够通过大量现成插件进行功能的拓展，缺点就是集成度不高，几乎都是依赖第三方插件，无法做到开箱即用。</strong></p> <p>Grunt 相当于是 NPM Script 的进化版，它的诞生就是弥补 NPM Script 的不足。</p> <blockquote><p>Gulp</p></blockquote> <p>Glup 是一个基于流的自动化构建工具。除了可以管理和执行任务，还支持监听文件、读写文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> src<span class="token punctuation">,</span> dest <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-babel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">default</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'src/*.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'output/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述栗子中，通过读取 src 目录下的所有 js 文件，通过 babel 插件转换后，然后写入到 output 目录下。</p> <p><strong>Gulp 的优点就是引入了流的概念，可以更好支持读写文件以及监听文件变化，缺点和 Grunt 一样，集成度依然不高，都是需要第三方插件完成大部分功能</strong>。</p> <p>Glup 可以看成是 Grunt 的加强版，相比于 Grunt，Glup 增加了监听文件、读写文件、流式处理的功能。</p> <blockquote><p>Fis3</p></blockquote> <p>Fis3 是一款来自百度的优秀国产构建工具。相比 Grunt 和 Glup，它集成了 Web 开发中的常用功能，主要包含如下：</p> <ul><li>读写文件。通过 fis.match 读文件</li> <li>资源定位。解析文件之间的依赖关系</li> <li>文件缓存。通过 useHash 配置输出文件时为文件 URL 加上 md5 戳，以优化浏览器的缓存</li> <li>文件编译。通过 parser 配置文件解析器来完成文件转换，如 ES6 转换成 ES5。</li> <li>压缩资源。通过 optimizer 配置代码压缩方法。</li> <li>图片合并。通过 spriter 配置合并 CSS 里导入的图片到一个文件中，从而减少 HTTP 请求。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fis<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'*.{js, css, png}'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// 为文件添加md5</span>
  useHash<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fis<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'*.ts'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// 转化ts文件</span>
  parser<span class="token punctuation">:</span> fis<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'typescript'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Fis3 的优点是集成了各种 Web 开发所需的构建功能，配置简单并且开箱即用。缺点就是官方目前不再进行更新和维护，也不支持最新版的 Node.js</strong>。</p> <p>Fis3 相比 Grunt 和 Glup 构建工具来说，进一步加强了集成功能，如果将 Grunt、Glup 比作汽车的发动机话，则可以将 Fis3 比作一辆完整的汽车。</p> <blockquote><p>Webpack</p></blockquote> <p>作为今天的主角——Webpack，可以说是目前集成功能最全、使用最广泛的构建工具。</p> <p>Webpack 是一个 JavaScript 打包模块化的工具，<strong>在 Webpack里一切文件皆模块，通过 Loader 转换文件，通过 Plugin 注入事件钩子，最后输出由多个模块组合成 Chunk 并转换成相应的文件进行输出</strong>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	entry<span class="token punctuation">:</span> <span class="token string">'./main.js'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Webpack 的优点在于专注处理模块化功能，能做到开箱即用、一步到位，能通过 Plugin 进行扩展，并且社区也活跃。缺点就是只能用于模块化开发的项目（其实这也不算是缺点，个人觉得）</strong>。</p> <p>相比之下，webpack 可以说是一个完整的集成度、完善的第三方插件管理和社区活跃的模块化构建工具。</p> <blockquote><p>Rollup</p></blockquote> <p>Rollup 是一个和 Webpack 很类似但专注于 ES6 的模块打包工具。它的亮点在于能够针对 ES6 源码进行 Tree Shaking 以及对没用的代码进行 Scope Hoisting，从而优化输出质量。当然，Webpack 也在内部实现这些功能。</p> <p>相比之下，Rollup 在用于打包 JavaScript 库时比 Webpack 更有优势，因为其打包出来的文件更小。但它的缺点就是还不够完善，在很多场景下还找不到相应的解决方案。</p> <h2 id="webpack构建流程"><a href="#webpack构建流程" class="header-anchor">#</a> Webpack构建流程</h2> <p>要了解 Webpack 是怎么进行构建的，首先得下列几个核心概念进行入手。</p> <ul><li>Entry：Webpack 构建的入口，也就是输入配置。</li> <li>Output：Webpack 构建的输出配置。</li> <li>Module：模块配置，一切文件都是模块，一个模块对应一个文件。</li> <li>Chunk：代码块，一个代码块由一个或多个模块构成，用于代码合并和分割。</li> <li>Loader：模块转换器，用于将模块的原内容转换成新内容。</li> <li>Plugin：插件扩展功能器，用于监听Webpack在生命周期内广播事件时执行相应的回调逻辑。</li></ul> <p>那么，Webpack 的构建流程是如何的呢？</p> <p><strong>其实 Webpack 的构建流程可分为三个阶段，分别是初始化阶段、编译阶段、输出阶段</strong>。下面就简单总结一下。</p> <ol><li><p>初始化阶段</p> <p>首先会初始化参数（shell脚本中参数和配置中参数合并），根据参数初始化 compiler 编译对象，接着就是加载配置项里的插件（创建相应插件实例，开始监听 Webpack 声明周期中的广播事件）。</p></li> <li><p>编译阶段</p> <p>将初始化阶段得到的 compiler 编译对象，执行 run 方法正式开始进行编译。</p> <p>首先会从配置项里的 Entry 入手，找到所有的入口模块。</p> <p>接着从入口模块开始递归寻找，将匹配到的模块使用相应的 Loader 进行转换，重复该过程直到所有的依赖模块寻找完为止。</p> <p>最后，编译结束后将得到所有转换好的模块以及各个模块之间的依赖关系。</p></li> <li><p>输出阶段</p> <p>根据编译阶段得到的各个模块间依赖关系，将一个个模块开始组合成一个 Chunk，并将 Chunk 转换文件，最终将文件输出到文件系统中。</p></li></ol> <p>在了解完 Webpack 的构建流程后，我相信你肯定和我有一个疑问，那就是<strong>为什么不直接将转换好的模块直接转变成文件输出？而是将多个模块根据依赖关系组成 Chunk 并转变成文件再输出？</strong></p> <p><strong>其实组成一个 Chunk 是有目的的，就是为了减少网络请求</strong>。如果仅仅是把转换好的模块转变成文件来输出，是没问题的，但是在浏览器中，访问一个模块文件时，当发现它还有依赖的文件，那么就需要通过网络请求相应的依赖文件，这样就不得不耗费时间在网络请求上。另外浏览器环境不像 Nodejs 那样能够快速滴从本地加载一个模块文件，因此根据依赖关系组装成一个 Chunk 并转换成文件后，将大大减少对网络的依赖程度。</p> <h2 id="理解-loader"><a href="#理解-loader" class="header-anchor">#</a> 理解 Loader</h2> <p>Loader 就像一个翻译员，能将源文件经过转换后输出新的内容，并且一个文件还能经过链式的 Loader 处理。</p> <p>在这里，我会先提一个问题，就是常问的，多个 Loader 的执行顺序是怎样的？为什么？</p> <p>其实，<strong>Loader 的执行顺序是从右到左的</strong>。Webpack 是由于跟随函数式编程的缘故，才会采取了从右到左的顺序执行 Loader。</p> <p><strong>Webpack 实现 Loader 执行选择函数式编程中的 compose 方式，而不是选择 pipe 方式</strong>（pipe 方式实现的是从左到右，如果要实现从左到右也不难）。在函数式编程中，实现方式都是从右到左的，看个🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 摘自网上例子</span>
<span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> fns<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">add1</span> <span class="token operator">=</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//加1</span>
<span class="token keyword">const</span> <span class="token function-variable function">double</span> <span class="token operator">=</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 乘2</span>
<span class="token keyword">const</span> add1ThenDouble <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  double<span class="token punctuation">,</span>
  add1
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">add1ThenDouble</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
<span class="token comment">// ((2 + 1 = 3) * 2 = 6) </span>
</code></pre></div><p>一个 Loader 就是一个 Node.js 模块，这个模块需要导出一个函数。导出函数的工作就是获得处理前的原内容，对原内容执行处理后返回处理后的内容。</p> <p>那么<strong>如果要编写一个简单的 Loader ，需要怎样子操作呢？</strong></p> <p>由于 Loader 是运行在 Node.js 中，所以我们可以调用任意的 Node.js 自带的 API，或者安装第三方模块进行调用，先看个最简单的编写栗子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-sass'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">sass</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>另外，Webpack 还提供了一些 API 供 Loader 调用，简单列举一下常用的 API。</p> <ul><li>this.callback。用于 webpack 和 loader 间的通信，在 loader 使用时，告诉 webpack 返回结果。</li> <li>this.context。假如当前 loader 处理的文件是 /src/main.js ，则 this.context 等于 /src。</li> <li>this.resource。当前处理文件的完整请求路径。</li> <li>this.resourceQuery。当前处理文件的 queryString。</li> <li>this.traget。相当于 Webpack 配置中的 Target。</li> <li>this.emitFile。输出一个文件。</li> <li>this.clearDependcies。清除当前正在处理文件的所有依赖。</li> <li>this.addDependcies。当前处理文件添加其依赖的文件。</li></ul> <p>那么编写完 Loader 后，如何让 Webpack 加载本地 Loader？</p> <ol><li><p>NPM link</p> <p>NPM link 专门用于开发和调试本地的 NPM 模块的，能做到不发布模版的情况下，将本地的一个正在开发的模版的源码链接到项目 node_modules 目录下，让项目可以直接使用本地的 NPM 模块。</p> <p>要完成 NPM 的步骤，需按以下实现：</p> <ul><li>确保在本地开发好 NPM 模块中 package.json 已经配置好。</li> <li>在本地的 NPM 模块目录下执行 npm link 命令，将本地模块注册到全局。</li> <li>在项目根目录下执行 npm link loader-name，将第二步注册到全局的本地 NPM 模块链接到项目的 node_modules 下，其中 loader-name 是指在第一步的 package.json 文件中配置的模块名称。</li></ul></li> <li><p>ResolveLoader</p> <p>为了让 Webpack 加载放在本地的 loader，可以直接配置 resolveLoader.modules。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolveLoader<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    modules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> <span class="token string">'./loaders/'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面配置中，当在 node_modules 中找不到相应的 loader 时，便会从 loaders 文件夹中去寻找。</p></li></ol> <h2 id="理解-plugin"><a href="#理解-plugin" class="header-anchor">#</a> 理解 Plugin</h2> <p>在 Webpack 运行的生命周期中会广播许多事件，Plugin 可以监听这些事件，在合适的时机通过 Webpack 提供的 API 改变输出结果。</p> <p>在开发 Plugin 时最常用的两个对象是 Compiler 对象和 Compilation 对象，它们是 Plugin 和 Webpack 之间的桥梁。</p> <ul><li>Compiler 对象：包含了 Webpack 环境的所有配置信息（即 options、loaders、plugins 等信息），可以理解为 Webpack 实例。</li> <li>Compilation 对象：包含了当前 Webpack 的模块资源、编译生成资源、变化的文件等。每当监测到一个文件发生变化，便有一次新的 Compilation 对象被创建。</li></ul> <p>那么，<strong>Compiler 对象和 Compilation对象之间的区别是什么？Compiler 对象代表了整个 Webpack 从启动到关闭的生命周期，而 Compilation 对象只代表一次新的编译</strong>。</p> <p>另外，<strong>Webpack 通过 Tagable 来组织这条复杂的生产线，在 Webpack 的运行过程中会广播事件，Plugin 只需要监听它关心的事件，就能加入这条生产线中，并能改变生产线的运作</strong>。</p> <p>Webpack 的事件流机制采用的是观察者模式，和 Node.js 中的 EventEmitter 非常相似，并且 Compiler 对象和 Compilation 对象都继承自 Tapable，可在 Compiler 对象和 Compilation 对象上广播和监听事件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 广播事件</span>
<span class="token function">compiler</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span>

<span class="token comment">// 监听事件</span>
compiler<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token comment">//... </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>因此，在编写一个 Plugin 时，可如下操作：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TextPlugin.js</span>
<span class="token keyword">class</span> <span class="token class-name">TextPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 在构造函数中获取用户为该插件传入的配置</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Webpack会调用TextPlugin实例的apply方法为插件实例传入compiler对象</span>
    compiler<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> TextPlugin <span class="token comment">// 导出plugin</span>

<span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> TextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./TextPlugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">TextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/keep-Learning/webpack/webpack-learning-and-summary/Webpack优化--构建速度篇.html">
        Webpack优化--构建速度篇
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/keep-Learning/assets/js/app.90ccec97.js" defer></script><script src="/keep-Learning/assets/js/2.71580b53.js" defer></script><script src="/keep-Learning/assets/js/112.e07a4e74.js" defer></script>
  </body>
</html>
