{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{265:function(t,s,a){\"use strict\";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"你对同构了解多少\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#你对同构了解多少\"}},[t._v(\"#\")]),t._v(\" 你对同构了解多少\")]),t._v(\" \"),a(\"p\",[t._v(\"在“刀耕火种”年代，前端工程师只需要给静态页面添加一些样式或动画，基本不会涉及到任何数据逻辑，后端工程师拿到前端编写好的静态页面，就开始匹配页面中需要动态获取的数据（即当用户请求页面时，后端进行处理并返回完整的静态页面），一般都是依赖模板引擎来完成这些任务。因此才会有 JSP、PHP 等的出现。\")]),t._v(\" \"),a(\"p\",[t._v(\"上面所提及的过程也就是所谓的\"),a(\"strong\",[t._v(\"服务端渲染过程（即 SSR ）\")]),t._v(\"，前端并不需要理会后端返回的内容正不正确，只需要理会 UI 即可，而这也是早期前端职位一直不被看好的缘故。\")]),t._v(\" \"),a(\"p\",[t._v(\"随着 React、Vue 等前端框架的发展，浏览器渲染过程（即 CSR ）也慢慢崭露头角，但最终带来的却是白屏、首屏加速、SEO 等问题。正因如此，才有了今天要说的同构的解决方案。先甭急，下面还有很多要讲的呢🤔。\")]),t._v(\" \"),a(\"h2\",{attrs:{id:\"目录\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#目录\"}},[t._v(\"#\")]),t._v(\" 目录\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"a\",{attrs:{href:\"#t1\"}},[a(\"span\",[t._v(\"SSR vs CSR\")])])]),t._v(\" \"),a(\"li\",[a(\"a\",{attrs:{href:\"#t2\"}},[a(\"span\",[t._v(\"预渲染究竟是啥？\")])])]),t._v(\" \"),a(\"li\",[a(\"a\",{attrs:{href:\"#t3\"}},[a(\"span\",[t._v(\"同构的含义以及作用\")])])]),t._v(\" \"),a(\"li\",[a(\"a\",{attrs:{href:\"#t4\"}},[a(\"span\",[t._v(\"构建同构应用\")])])]),t._v(\" \"),a(\"li\",[a(\"a\",{attrs:{href:\"#t5\"}},[a(\"span\",[t._v(\"同构的原理\")])])])]),t._v(\" \"),a(\"h2\",{attrs:{id:\"ssr-vs-csr\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#ssr-vs-csr\"}},[t._v(\"#\")]),t._v(\" SSR vs CSR\")]),t._v(\" \"),a(\"p\",[t._v(\"上面提及了 SSR 和 CSR，对于陌生的童鞋可能会有疑惑，究竟它们长的是啥样子？我们就从代码层面简单理一下。\")]),t._v(\" \"),a(\"p\",[t._v(\"SSR，顾名思义就是数据初始化都是交给后端管理，前端只需要渲染页面 UI 即可。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" express \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'express'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" app \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"express\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\napp\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"get\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'/'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token parameter\"}},[t._v(\"res\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" req\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  res\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"send\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token template-string\"}},[a(\"span\",{pre:!0,attrs:{class:\"token template-punctuation string\"}},[t._v(\"`\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\\n  <!DOCTYPE html>\\n  <html lang=\"en\">\\n  <head>\\n    <meta charset=\"UTF-8\">\\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\\n    <title>SSR</title>\\n  </head>\\n  <body>\\n    <div id=\"app\">\\n    \\t<span>Hello, SSR...</span>\\n    </div>\\n    <script src=\"./dist/bundle.js\"><\\/script>\\n  </body>\\n  </html>\\n  ')]),a(\"span\",{pre:!0,attrs:{class:\"token template-punctuation string\"}},[t._v(\"`\")])]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"代码中使用了 Express 举了一个栗子，可以看到模板中的所有标签都是直接通过后端返回，包括数据处理。前端拿到这坨字符串后，直接渲染即可。好明显，\"),a(\"strong\",[t._v(\"对于 SSR，由于数据在后端处理上会显得更高的效率，因此在前端渲染时就不会出现诸如白屏、首屏加载慢等问题，而且还有助于 SEO，不利于前后端分离，后端负担过重\")]),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"再来看看 CSR，后端只返回简单的标签，前端除了负责 UI 展示外还需要处理数据初始化。下面就以 React 举个例子。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 后端返回的html模板\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"!\")]),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"DOCTYPE\")]),t._v(\" html\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"html lang\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"en\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"head\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"meta charset\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"UTF-8\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"meta name\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"viewport\"')]),t._v(\" content\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"width=device-width, initial-scale=1.0\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"meta http\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"equiv\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"X-UA-Compatible\"')]),t._v(\" content\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"ie=edge\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"title\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"CSR\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"title\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"head\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"body\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"div id\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"app\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"div\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"script src\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"./dist/react.js\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"script\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"body\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"html\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// 前端UI展示以及数据初始化\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"import\")]),t._v(\" React \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"from\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'react'\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"import\")]),t._v(\" ReactDom \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"from\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'react-dom'\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"App\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"\\n  \\t\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"span\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"Hello\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"CSR\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"...\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"span\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\nReactDom\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"render\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"App \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" document\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"querySelector\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'#app'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"CSR 对于使用过 React、Vue 等框架的童鞋们应该很好理解，无非就是在指定 DOM 节点下面做一些诸如子节点渲染、路由配置以及数据处理的工作。\"),a(\"strong\",[t._v(\"对于 CSR，常用于操作 SPA（即单页面应用），有利于前后端分离，前端只管理自身业务逻辑以及 UI 展示，后端只需要管理 API 制定，但是却存在白屏、首屏加速以及 SEO 等问题\")]),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"综上，\"),a(\"strong\",[t._v(\"SSR\")]),t._v(\" 有利于用户体验以及市场开拓，而 \"),a(\"strong\",[t._v(\"CSR\")]),t._v(\" 则有利于技术人员管理，而这两者刚好就是\"),a(\"strong\",[t._v(\"互补\")]),t._v(\"的。\")]),t._v(\" \"),a(\"p\",[t._v(\"也许，有的童鞋会提出直接将 SSR 和 CSR 相结合不就稳妥了？\")]),t._v(\" \"),a(\"p\",[t._v(\"答案是正确，由于 SSR 和 CSR 是互补的，所以相结合后刚好就可以很好滴处理上述种种问题。那么问题又来了，要将 SSR 和 CSR 相结合，要怎么做？\")]),t._v(\" \"),a(\"p\",[t._v(\"我猜你也应该知道答案，那就是今天的主角——同构。\")]),t._v(\" \"),a(\"p\",[a(\"strong\",[t._v(\"所谓同构，就是写一份代码可同时在浏览器和服务器中运行应用\")]),t._v(\"。\")]),t._v(\" \"),a(\"h2\",{attrs:{id:\"预渲染究竟是啥？\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#预渲染究竟是啥？\"}},[t._v(\"#\")]),t._v(\" 预渲染究竟是啥？\")]),t._v(\" \"),a(\"p\",[t._v(\"在讲解同构之前，我先岔开一个话题，那就是简单讲一讲预渲染。\")]),t._v(\" \"),a(\"p\",[t._v(\"相信部分童鞋对于这个预渲染显得有点陌生，不是都已经有 SSR 和 CSR 了吗？那这个预渲染又是一个什么鬼。。😂\")]),t._v(\" \"),a(\"p\",[a(\"strong\",[t._v(\"所谓预渲染，其实就是无需服务器实时动态编译，在构建时针对特定路由简单滴生成静态 HTML 文件\")]),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"咋一看，跟服务端渲染很类似，都是最终输出静态 HTML 文件。但是细心一看，\"),a(\"strong\",[t._v(\"预渲染和服务端渲染还是有很大区别\")]),t._v(\"，我列举一下。\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[t._v(\"预渲染是在构建时针对路由输出静态 HTML 并且无需任何无服务器，服务端渲染则是通过 Node 作为中间层输出 HTML。\")]),t._v(\" \"),a(\"li\",[t._v(\"预渲染的文件输出是不依赖于数据的，而服务端渲染的输出文件却是依赖于数据的。\")])]),t._v(\" \"),a(\"p\",[t._v(\"借用尤大大的说法，\"),a(\"strong\",[t._v(\"如果你调研服务器端渲染(SSR)只是用来改善少数营销页面（例如 /, /about, /contact 等）的 SEO，那么你可能需要\"),a(\"a\",{attrs:{href:\"https://github.com/chrisvfritz/prerender-spa-plugin\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"预渲染\"),a(\"OutboundLink\")],1)]),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"很简单，预渲染的处理场景就是用于改善少数静态页面的 SEO 的，并且无数据依赖的。\")]),t._v(\" \"),a(\"h2\",{attrs:{id:\"同构的含义以及作用\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#同构的含义以及作用\"}},[t._v(\"#\")]),t._v(\" 同构的含义以及作用\")]),t._v(\" \"),a(\"p\",[t._v(\"看完上面的对比描述，相信你应该对同构有一定的了解，但并不妨碍我重复提一下。\")]),t._v(\" \"),a(\"p\",[t._v(\"同构就是前后端共用一套代码或逻辑，而在这套代码或逻辑中，理想的情况是在浏览器进一步渲染的过程中，判断已有的 DOM 结构和即将渲染出的结构是否相同，若相同则不需要重新渲染 DOM 结构，只进行事件绑定即可。\")]),t._v(\" \"),a(\"p\",[t._v(\"那么，同构有何作用？\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[t._v(\"更好的性能。主要体现在首屏加速、文件更少。\")]),t._v(\" \"),a(\"li\",[t._v(\"SEO 优化支持。服务端接收到请求后，会返回一个相对完整并包含初始内容的 HTML 文档，所以更有利于搜索引擎爬虫获取数据。\")]),t._v(\" \"),a(\"li\",[t._v(\"可维护性强。利用同一套代码管理，避免客户端和服务端同时维护两套代码或逻辑。\")]),t._v(\" \"),a(\"li\",[t._v(\"对低端机型更友好。由于初步渲染都在服务端完成，低端机型不需要兼容直接渲染内容即可。\")]),t._v(\" \"),a(\"li\",[t._v(\"用户体验更好。\")])]),t._v(\" \"),a(\"p\",[t._v(\"讲了那么多好处，也该说说坏处吧？\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[t._v(\"服务端无法完全复用浏览器端代码。\")]),t._v(\" \"),a(\"li\",[t._v(\"Node 层不稳定，对首屏加载有一定影响。\")]),t._v(\" \"),a(\"li\",[t._v(\"服务端逻辑处理增多，增加了复杂性。\")])]),t._v(\" \"),a(\"p\",[t._v(\"总的来说，对于首屏加载速度有追求的技术人员来说，同构还是一个最好的选择。\")]),t._v(\" \"),a(\"h2\",{attrs:{id:\"构建同构应用\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#构建同构应用\"}},[t._v(\"#\")]),t._v(\" 构建同构应用\")]),t._v(\" \"),a(\"p\",[t._v(\"在优秀框架 React、Vue 中，其实已经拥有很好的构建同构应用的框架，分别是 Next.js、Nuxt.js。\")]),t._v(\" \"),a(\"p\",[t._v(\"既然如此，那为啥还要讲解构建同构应用呢？\")]),t._v(\" \"),a(\"p\",[t._v(\"其实讲这个，目的在于理解同构在构建时的原理，方便大家能对同构有一个更好的认识。话不多说，直接走起！\")]),t._v(\" \"),a(\"p\",[t._v(\"下面我会以 React 作为举例，从 0 开始构建一个 React 的简单同构应用。\")]),t._v(\" \"),a(\"p\",[t._v(\"我们先使用 NPM 构建一个本地项目，如下操作。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[t._v(\"mkdir react\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"ssr\\ncd react\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"ssr\\nnpm init \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"y\\nnpm i \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"D\")]),t._v(\" webpack webpack\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"cli\\n\")])])]),a(\"p\",[t._v(\"安装基本配置后，我们就可以正式编写同构应用。\")]),t._v(\" \"),a(\"p\",[t._v(\"先创建一个公共组件文件\"),a(\"code\",[t._v(\"App.js\")]),t._v(\"，用于展示 UI。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-react extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"// App.js\\nimport React, { Component } from 'react'\\nexport default function App() {\\n  return (\\n  \\t<span>Hello, React SSR...</span>\\n  )\\n}\\n\")])])]),a(\"p\",[t._v(\"接着开始实现服务端，由于上面提及过，会使用 Node 作为中间层，所以接下来我会使用 Express。\")]),t._v(\" \"),a(\"p\",[t._v(\"在 React 中，提供了一个\"),a(\"code\",[t._v(\"renderToString\")]),t._v(\"的 API 用于将组件渲染成对应静态模板。有些童鞋在这一步也许会直接将刚刚创建的 App 组件渲染成相应的静态模板，我是不推荐的，我更推荐的是惰性渲染，也就是等到匹配相应的路由时才去渲染。\")]),t._v(\" \"),a(\"p\",[t._v(\"接着创建一个服务端渲染静态模板中间惰性渲染文件\"),a(\"code\",[t._v(\"main-server.js\")]),t._v(\"。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// main-server.js\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"import\")]),t._v(\" React \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"from\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'react'\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"import\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" renderToString \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"from\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'react-dom/server'\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"import\")]),t._v(\" App \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"from\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'./App'\")]),t._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"export\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"function\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"render\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"return\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"renderToString\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"App \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"然后就是创建真正的处理服务端渲染逻辑的后端文件\"),a(\"code\",[t._v(\"http-server.js\")]),t._v(\"。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// http-server.js\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" express \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'express'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" render \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'./dist/bundle-server.js'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" app \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"express\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\napp\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"get\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'/'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token parameter\"}},[t._v(\"req\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" res\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=>\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  res\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"send\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token template-string\"}},[a(\"span\",{pre:!0,attrs:{class:\"token template-punctuation string\"}},[t._v(\"`\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\\n  <!DOCTYPE html>\\n  <html lang=\"en\">\\n  <head>\\n    <meta charset=\"UTF-8\">\\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\\n    <title>React SSR...</title>\\n  </head>\\n  <body>\\n    <div id=\"app\">')]),a(\"span\",{pre:!0,attrs:{class:\"token interpolation\"}},[a(\"span\",{pre:!0,attrs:{class:\"token interpolation-punctuation punctuation\"}},[t._v(\"${\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"render\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token interpolation-punctuation punctuation\"}},[t._v(\"}\")])]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('</div>\\n    <script src=\"./dist/bundle.js\"><\\/script>\\n  </body>\\n  </html>\\n  ')]),a(\"span\",{pre:!0,attrs:{class:\"token template-punctuation string\"}},[t._v(\"`\")])]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\napp\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"use\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"express\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"static\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'.'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\napp\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"listen\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"3000\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\n\")])])]),a(\"p\",[t._v(\"可以看到，当匹配到根路径时，才会在静态模板中执行方法\"),a(\"code\",[t._v(\"renderToString\")]),t._v(\"渲染组件\"),a(\"code\",[t._v(\"App\")]),t._v(\"。\")]),t._v(\" \"),a(\"p\",[t._v(\"至此，服务端编写完毕，是不是觉得妥妥的？接着我们编写客户端代码，React 提供一个\"),a(\"code\",[t._v(\"hydrate\")]),t._v(\"方法，用于匹配服务端渲染的 DOM 节点的，即判断 DOM 节点是否为服务端渲染生成，若是则不再重新渲染该 DOM 节点，直接执行后续操作，有效地避免重复渲染导致的性能损耗。\")]),t._v(\" \"),a(\"p\",[t._v(\"创建客户端渲染组件文件\"),a(\"code\",[t._v(\"main-browser.js\")]),t._v(\"，并挂载到相应的 DOM 节点中。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-react extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[t._v(\"// main-browser.js\\nimport React from 'react'\\nimport { render, hydrate } from 'react-dom'\\nimport App from './App'\\n\\nhydrate(<App />, document.getElementById('app'))\\n\")])])]),a(\"p\",[t._v(\"客户端编写完毕，真是万事俱备，只欠东风啊。。就只剩跑起来了。\")]),t._v(\" \"),a(\"p\",[t._v(\"接下来我们需要将客户端和服务端分别构建，为什么？很简单，因为服务端代码和客户端不能打包到一个地方的，因为两个采取模式不一致。所以我们需要分别为客户端和服务端创建构建文件。\")]),t._v(\" \"),a(\"p\",[t._v(\"等等，先别急，我们还需要装点东西，那就是 babel、preset-react 和 webpack-node-externals。\")]),t._v(\" \"),a(\"ul\",[a(\"li\",[t._v(\"babel：将编写的 ES6 代码编译成 ES5 代码。\")]),t._v(\" \"),a(\"li\",[t._v(\"preset-react：识别 React 中的 JSX，并将其转译成 React.createElement。\")]),t._v(\" \"),a(\"li\",[t._v(\"webpack-node-externals：能够排除 \"),a(\"code\",[t._v(\"node_modules\")]),t._v(\" 目录中所有模块，用于服务端构建，因为 Node.js 会默认去\"),a(\"code\",[t._v(\"node_modules\")]),t._v(\"目录下寻找和使用第三方模块。\")])]),t._v(\" \"),a(\"p\",[t._v(\"安装上述依赖包命令如下：\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[t._v(\"npm i \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"D\")]),t._v(\" babel\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"loader @babel\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"core @babel\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"preset\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"env @babel\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"preset\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"react webpack\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"node\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"externals\\n\")])])]),a(\"p\",[t._v(\"接着就是需要创建\"),a(\"code\",[t._v(\".babelrc\")]),t._v(\"文件配置 babel 规则啦。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// .babelrc\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"presets\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"@babel/preset-env\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"@babel/preset-react\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"基本配置都弄好，就可以正式配置 webpack。分别创建\"),a(\"code\",[t._v(\"webpack.config.client.js\")]),t._v(\"和\"),a(\"code\",[t._v(\"webpack.config.server.js\")]),t._v(\"文件。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// webpack.config.client.js\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" path \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'path'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" nodeExternals \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'webpack-node-externals'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\nmodule\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"exports \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  mode\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'development'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  entry\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'./main-browser.js'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  output\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    filename\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"bundle-browser.js\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n    path\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" path\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"resolve\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"__dirname\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'dist'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  module\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    rules\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),t._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" test\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token regex\"}},[t._v(\"/\\\\.js$/\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" exclude\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token regex\"}},[t._v(\"/node_modules/\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" loader\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"babel-loader\"')]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"// webpack.config.server.js\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" path \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'path'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"const\")]),t._v(\" nodeExternals \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"require\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'webpack-node-externals'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n\\nmodule\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),t._v(\"exports \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  mode\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'development'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  entry\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'./main-server.js'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  target\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'node'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  externals\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"nodeExternals\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  output\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    libraryTarget\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'commonjs2'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n    filename\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'bundle-server.js'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n    path\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" path\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\".\")]),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[t._v(\"resolve\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"(\")]),t._v(\"__dirname\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v(\"'./dist'\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\")\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n  module\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n    rules\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),t._v(\"\\n      \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\" test\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token regex\"}},[t._v(\"/\\\\.js$/\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" exclude\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token regex\"}},[t._v(\"/node_modules/\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\" loader\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"babel-loader\"')]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"在服务端构建中，必须在输出中指定\"),a(\"code\",[t._v(\"libraryTarget: 'commonjs2'\")]),t._v(\"，首先 Node 中遵循的是 commonjs 规范，以 Commonjs2 规范导出渲染函数，可供 Node 编写 HTTP 服务器代码调用。\")]),t._v(\" \"),a(\"p\",[t._v(\"最后一步，就是需要在\"),a(\"code\",[t._v(\"package.json\")]),t._v(\"文件中直接编写 Shell 命令啦。在这里，要推荐的是**\"),a(\"a\",{attrs:{href:\"https://github.com/kimmobrunfeldt/concurrently\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"concurrently\"),a(\"OutboundLink\")],1),t._v(\"**，它的用处就是可以执行多条指令，而不需要在多个命令行中执行多个指令。我们先安装：\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[t._v(\"npm i \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),a(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[t._v(\"S\")]),t._v(\" concurrently\\n\")])])]),a(\"p\",[t._v(\"接着就可以在\"),a(\"code\",[t._v(\"package.json\")]),t._v(\"中的\"),a(\"code\",[t._v(\"scripts\")]),t._v(\"属性编写命令。\")]),t._v(\" \"),a(\"div\",{staticClass:\"language-javascript extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-javascript\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"scripts\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"{\")]),t._v(\"\\n  \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"start\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\":\")]),t._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[t._v('\"concurrently \\\\\"node ./http-server.js\\\\\" \\\\\"webpack --watch --config webpack.server.config.js\\\\\" \\\\\"webpack --config webpack.client.config.js\\\\\"\"')]),t._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"}\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\",\")]),t._v(\"\\n\")])])]),a(\"p\",[t._v(\"最后的最后，就可以执行\"),a(\"code\",[t._v(\"npm start\")]),t._v(\"执行项目，在\"),a(\"code\",[t._v(\"localhost:3000\")]),t._v(\"中看到效果啦。😄\")]),t._v(\" \"),a(\"p\",[t._v(\"另外，我还推荐大家可以参考一下\"),a(\"a\",{attrs:{href:\"http://ykfe.net/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"Egg + React + SSR 服务端渲染\"),a(\"OutboundLink\")],1),t._v(\"，有助于更好滴认识如何构建同构应用。\")]),t._v(\" \"),a(\"h2\",{attrs:{id:\"同构的原理\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#同构的原理\"}},[t._v(\"#\")]),t._v(\" 同构的原理\")]),t._v(\" \"),a(\"p\",[t._v(\"相信看完上述的简单配置，你们对同构应该会有一个大概的了解 🤔。那么我应该说一下同构的原理。\")]),t._v(\" \"),a(\"ol\",[a(\"li\",[a(\"p\",[t._v(\"客户端发出请求获取\"),a(\"code\",[t._v(\"index.html\")]),t._v(\"页面，Node server 接收到客户端请求后，匹配相应路由。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"当匹配到相应路由后，就需要请求所需要的数据，并以 props 或 context 或 store 形式传入组件，使用\"),a(\"code\",[t._v(\"renderToString\")]),t._v(\"或\"),a(\"code\",[t._v(\"renderToNodeStream\")]),t._v(\"的 API 将组件渲染为 html 字符串或 stream 流。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"由于客户端拿到 html 字符串或 stream 流后，还需要同步数据，因此服务端还需要将初始化数据注入到 html 字符串或 stream 流中，在客户端中获取到初始数据，最后使用\"),a(\"code\",[t._v(\"hydrate\")]),t._v(\"方法同步服务端渲染的 DOM 节点，从而避免重新渲染相同的节点。\")])]),t._v(\" \"),a(\"li\",[a(\"p\",[t._v(\"最后执行组件的\"),a(\"code\",[t._v(\"componentDidMount\")]),t._v(\"生命周期，完成组件内事件绑定和一些交互，浏览器重用了服务端输出的 DOM 节点，整个流程结束\")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);","extractedComments":[]}